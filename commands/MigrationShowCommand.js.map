{"version":3,"sources":["../../src/commands/MigrationShowCommand.ts"],"names":[],"mappings":";;;;AAAA,sCAA4C;AAC5C,iFAA8E;AAE9E,4DAAmC;AAEnC,2DAA0D;AAE1D;;GAEG;AACH;IAAA;QAEE,YAAO,GAAG,gBAAgB,CAAC;QAC3B,aAAQ,GAAG,2DAA2D,CAAC;IA4CzE,CAAC;IA1CC,sCAAO,GAAP,UAAQ,IAAgB;QACtB,OAAO,IAAI;aACR,MAAM,CAAC,YAAY,EAAE;YACpB,KAAK,EAAE,GAAG;YACV,OAAO,EAAE,SAAS;YAClB,QAAQ,EAAE,8CAA8C;SACzD,CAAC;aACD,MAAM,CAAC,QAAQ,EAAE;YAChB,KAAK,EAAE,GAAG;YACV,OAAO,EAAE,WAAW;YACpB,QAAQ,EAAE,iDAAiD;SAC5D,CAAC,CAAC;IACP,CAAC;IAEK,sCAAO,GAAb,UAAc,IAAqB;;;;;;wBAC7B,UAAU,GAAyB,SAAS,CAAC;;;;wBAEzC,uBAAuB,GAAG,IAAI,iDAAuB,CAAC;4BAC1D,IAAI,EAAE,OAAO,CAAC,GAAG,EAAE;4BACnB,UAAU,EAAE,IAAI,CAAC,MAAa;yBAC/B,CAAC,CAAC;wBACuB,qBAAM,uBAAuB,CAAC,GAAG,CAAC,IAAI,CAAC,UAAiB,CAAC,EAAA;;wBAA7E,iBAAiB,GAAG,SAAyD;wBACnF,MAAM,CAAC,MAAM,CAAC,iBAAiB,EAAE;4BAC/B,WAAW,EAAE,EAAE;4BACf,WAAW,EAAE,KAAK;4BAClB,aAAa,EAAE,KAAK;4BACpB,UAAU,EAAE,KAAK;4BACjB,OAAO,EAAE,CAAC,OAAO,EAAE,OAAO,EAAE,QAAQ,CAAC;yBACtC,CAAC,CAAC;wBACU,qBAAM,IAAA,0BAAgB,EAAC,iBAAiB,CAAC,EAAA;;wBAAtD,UAAU,GAAG,SAAyC,CAAC;wBACvD,qBAAM,UAAU,CAAC,cAAc,EAAE,EAAA;;wBAAjC,SAAiC,CAAC;wBAClC,qBAAM,UAAU,CAAC,KAAK,EAAE,EAAA;;wBAAxB,SAAwB,CAAC;wBAEzB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;;;;6BAGZ,UAAU,EAAV,wBAAU;wBAAE,qBAAO,UAAyB,CAAC,KAAK,EAAE,EAAA;;wBAAxC,SAAwC,CAAC;;;wBACzD,6BAAa,CAAC,SAAS,CAAC,8BAA8B,EAAE,KAAG,CAAC,CAAC;wBAC7D,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;;;;;;KAEnB;IAEH,2BAAC;AAAD,CA/CA,AA+CC,IAAA;AA/CY,oDAAoB","file":"MigrationShowCommand.js","sourcesContent":["import {createConnection} from \"../globals\";\r\nimport {ConnectionOptionsReader} from \"../connection/ConnectionOptionsReader\";\r\nimport {Connection} from \"../connection/Connection\";\r\nimport * as process from \"process\";\r\nimport * as yargs from \"yargs\";\r\nimport { PlatformTools } from \"../platform/PlatformTools\";\r\n\r\n/**\r\n * Runs migration command.\r\n */\r\nexport class MigrationShowCommand implements yargs.CommandModule {\r\n\r\n  command = \"migration:show\";\r\n  describe = \"Show all migrations and whether they have been run or not\";\r\n\r\n  builder(args: yargs.Argv) {\r\n    return args\r\n      .option(\"connection\", {\r\n        alias: \"c\",\r\n        default: \"default\",\r\n        describe: \"Name of the connection on which run a query.\"\r\n      })\r\n      .option(\"config\", {\r\n        alias: \"f\",\r\n        default: \"ormconfig\",\r\n        describe: \"Name of the file with connection configuration.\"\r\n      });\r\n  }\r\n\r\n  async handler(args: yargs.Arguments) {\r\n    let connection: Connection|undefined = undefined;\r\n    try {\r\n      const connectionOptionsReader = new ConnectionOptionsReader({\r\n        root: process.cwd(),\r\n        configName: args.config as any\r\n      });\r\n      const connectionOptions = await connectionOptionsReader.get(args.connection as any);\r\n      Object.assign(connectionOptions, {\r\n        subscribers: [],\r\n        synchronize: false,\r\n        migrationsRun: false,\r\n        dropSchema: false,\r\n        logging: [\"query\", \"error\", \"schema\"]\r\n      });\r\n      connection = await createConnection(connectionOptions);\r\n      await connection.showMigrations();\r\n      await connection.close();\r\n\r\n      process.exit(0);\r\n\r\n    } catch (err) {\r\n      if (connection) await (connection as Connection).close();\r\n      PlatformTools.logCmdErr(\"Error during migration show:\", err);\r\n      process.exit(1);\r\n    }\r\n  }\r\n\r\n}\r\n"],"sourceRoot":".."}