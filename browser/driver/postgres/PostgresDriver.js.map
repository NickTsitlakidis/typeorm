{"version":3,"sources":["../browser/src/driver/postgres/PostgresDriver.ts"],"names":[],"mappings":";AAEA,OAAO,EAAC,uBAAuB,EAAC,MAAM,qCAAqC,CAAC;AAC5E,OAAO,EAAC,8BAA8B,EAAC,MAAM,4CAA4C,CAAC;AAE1F,OAAO,EAAC,cAAc,EAAC,MAAM,+BAA+B,CAAC;AAC7D,OAAO,EAAC,aAAa,EAAC,MAAM,8BAA8B,CAAC;AAE3D,OAAO,EAAC,kBAAkB,EAAC,MAAM,yCAAyC,CAAC;AAE3E,OAAO,EAAC,sBAAsB,EAAC,MAAM,mCAAmC,CAAC;AACzE,OAAO,EAAC,SAAS,EAAC,MAAM,sBAAsB,CAAC;AAC/C,OAAO,EAAC,QAAQ,EAAC,MAAM,qBAAqB,CAAC;AAM7C,OAAO,EAAC,YAAY,EAAC,MAAM,yBAAyB,CAAC;AAGrD,OAAO,EAAC,mBAAmB,EAAC,MAAM,uBAAuB,CAAC;AAC1D,OAAO,EAAC,WAAW,EAAC,MAAM,gBAAgB,CAAC;AAC3C,OAAO,EAAE,YAAY,EAAE,MAAM,aAAa,CAAC;AAC3C,OAAO,EAAE,KAAK,EAAE,MAAM,kCAAkC,CAAC;AACzD,OAAO,EAAE,IAAI,EAAE,MAAM,gCAAgC,CAAC;AACtD,OAAO,EAAE,eAAe,EAAE,MAAM,4CAA4C,CAAC;AAE7E;;GAEG;AACH;IAyPI,4EAA4E;IAC5E,cAAc;IACd,4EAA4E;IAE5E,wBAAY,UAAuB;QAxOnC;;;WAGG;QACH,WAAM,GAAU,EAAE,CAAC;QAEnB;;WAEG;QACH,0BAAqB,GAAkB,EAAE,CAAC;QA+B1C;;WAEG;QACH,iBAAY,GAAY,KAAK,CAAC;QAE9B;;WAEG;QACH,gBAAW,GAAG,IAAI,CAAC;QAEnB;;WAEG;QACH,uBAAkB,GAAG,QAAiB,CAAC;QAEvC;;;;;WAKG;QACH,uBAAkB,GAAiB;YAC/B,KAAK;YACL,MAAM;YACN,MAAM;YACN,MAAM;YACN,UAAU;YACV,SAAS;YACT,QAAQ;YACR,SAAS;YACT,SAAS;YACT,MAAM;YACN,OAAO;YACP,QAAQ;YACR,QAAQ;YACR,kBAAkB;YAClB,OAAO;YACP,mBAAmB;YACnB,SAAS;YACT,WAAW;YACX,MAAM;YACN,MAAM;YACN,QAAQ;YACR,QAAQ;YACR,OAAO;YACP,KAAK;YACL,QAAQ;YACR,aAAa;YACb,QAAQ;YACR,aAAa;YACb,WAAW;YACX,6BAA6B;YAC7B,0BAA0B;YAC1B,MAAM;YACN,MAAM;YACN,wBAAwB;YACxB,qBAAqB;YACrB,UAAU;YACV,MAAM;YACN,SAAS;YACT,MAAM;YACN,OAAO;YACP,MAAM;YACN,MAAM;YACN,KAAK;YACL,MAAM;YACN,SAAS;YACT,QAAQ;YACR,MAAM;YACN,MAAM;YACN,SAAS;YACT,UAAU;YACV,SAAS;YACT,MAAM;YACN,KAAK;YACL,MAAM;YACN,OAAO;YACP,WAAW;YACX,WAAW;YACX,UAAU;YACV,SAAS;YACT,WAAW;YACX,WAAW;YACX,UAAU;YACV,WAAW;YACX,MAAM;YACN,OAAO;SACV,CAAC;QAEF;;WAEG;QACM,wBAAmB,GAAG,uBAAuB,CAAC;QAEvD;;WAEG;QACH,iBAAY,GAAiB;YACzB,UAAU;YACV,WAAW;SACd,CAAC;QAEF;;WAEG;QACH,0BAAqB,GAAiB;YAClC,mBAAmB;YACnB,SAAS;YACT,WAAW;YACX,MAAM;YACN,KAAK;YACL,QAAQ;YACR,aAAa;SAChB,CAAC;QAEF;;WAEG;QACH,6BAAwB,GAAiB;YACrC,SAAS;YACT,SAAS;YACT,UAAU;YACV,wBAAwB;YACxB,qBAAqB;YACrB,6BAA6B;YAC7B,0BAA0B;SAC7B,CAAC;QAEF;;WAEG;QACH,yBAAoB,GAAiB;YACjC,SAAS;YACT,SAAS;SACZ,CAAC;QAEF;;;WAGG;QACH,oBAAe,GAAsB;YACjC,UAAU,EAAE,WAAW;YACvB,iBAAiB,EAAE,OAAO;YAC1B,UAAU,EAAE,WAAW;YACvB,iBAAiB,EAAE,OAAO;YAC1B,UAAU,EAAE,WAAW;YACvB,kBAAkB,EAAE,IAAI;YACxB,OAAO,EAAE,MAAM;YACf,SAAS,EAAE,MAAM;YACjB,WAAW,EAAE,MAAM;YACnB,aAAa,EAAE,SAAS;YACxB,kBAAkB,EAAE,MAAM;YAC1B,OAAO,EAAE,MAAM;YACf,eAAe,EAAE,SAAS;YAC1B,SAAS,EAAE,MAAM;YACjB,aAAa,EAAE,MAAM;YACrB,UAAU,EAAE,MAAM;YAClB,WAAW,EAAE,MAAM;YACnB,YAAY,EAAE,SAAS;YACvB,gBAAgB,EAAE,SAAS;YAC3B,cAAc,EAAE,SAAS;YACzB,aAAa,EAAE,SAAS;YACxB,YAAY,EAAE,SAAS;YACvB,aAAa,EAAE,MAAM;SACxB,CAAC;QAEF;;;WAGG;QACH,qBAAgB,GAAqB;YACjC,WAAW,EAAE,EAAE,MAAM,EAAE,CAAC,EAAE;YAC1B,KAAK,EAAE,EAAE,MAAM,EAAE,CAAC,EAAE;YACpB,UAAU,EAAE,EAAE,SAAS,EAAE,CAAC,EAAE;YAC5B,wBAAwB,EAAE,EAAE,SAAS,EAAE,CAAC,EAAE;YAC1C,qBAAqB,EAAE,EAAE,SAAS,EAAE,CAAC,EAAE;YACvC,6BAA6B,EAAE,EAAE,SAAS,EAAE,CAAC,EAAE;YAC/C,0BAA0B,EAAE,EAAE,SAAS,EAAE,CAAC,EAAE;SAC/C,CAAC;QAEF;;;WAGG;QACH,mBAAc,GAAG,EAAE,CAAC;QAEpB,gCAA2B,GAAY,KAAK,CAAC;QAOzC,IAAI,CAAC,UAAU,EAAE;YACb,OAAO;SACV;QAED,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;QAC7B,IAAI,CAAC,OAAO,GAAG,UAAU,CAAC,OAAoC,CAAC;QAC/D,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC;QAC5D,IAAG,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;YACpB,OAAO,CAAC,GAAG,CAAC,IAAI,GAAG,KAAK,CAAC;SAC5B;QACD,wBAAwB;QACxB,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAExB,IAAI,CAAC,QAAQ,GAAG,WAAW,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,QAAQ,CAAC;QACnI,IAAI,CAAC,MAAM,GAAG,WAAW,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,MAAM,CAAC;QAElE,kHAAkH;QAClH,kDAAkD;QAClD,oDAAoD;QACpD,0BAA0B;QAC1B,iDAAiD;QACjD,8BAA8B;QAC9B,qDAAqD;QACrD,8BAA8B;QAC9B,qDAAqD;IACzD,CAAC;IAED,4EAA4E;IAC5E,6BAA6B;IAC7B,4EAA4E;IAE5E;;;;OAIG;IACG,gCAAO,GAAb;;;;;;;6BAEQ,IAAI,CAAC,OAAO,CAAC,WAAW,EAAxB,wBAAwB;wBACxB,KAAA,IAAI,CAAA;wBAAU,qBAAM,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,MAAM,CAAC,GAAG,CAAC,UAAA,KAAK;gCACrE,OAAO,KAAI,CAAC,UAAU,CAAC,KAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;4BAChD,CAAC,CAAC,CAAC,EAAA;;wBAFH,GAAK,MAAM,GAAG,SAEX,CAAC;wBACJ,KAAA,IAAI,CAAA;wBAAU,qBAAM,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,MAAM,CAAC,EAAA;;wBAAlF,GAAK,MAAM,GAAG,SAAoE,CAAC;;;wBAEnF,KAAA,IAAI,CAAA;wBAAU,qBAAM,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,EAAA;;wBAA/D,GAAK,MAAM,GAAG,SAAiD,CAAC;;;6BAGhE,CAAA,CAAC,IAAI,CAAC,QAAQ,IAAI,CAAC,IAAI,CAAC,YAAY,CAAA,EAApC,yBAAoC;wBAChB,qBAAM,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,EAAA;;wBAApD,WAAW,GAAG,SAAsC;6BAEtD,CAAC,IAAI,CAAC,QAAQ,EAAd,wBAAc;wBACd,KAAA,IAAI,CAAA;wBAAY,qBAAM,WAAW,CAAC,kBAAkB,EAAE,EAAA;;wBAAtD,GAAK,QAAQ,GAAG,SAAsC,CAAC;;;6BAGvD,CAAC,IAAI,CAAC,YAAY,EAAlB,yBAAkB;wBAClB,KAAA,IAAI,CAAA;wBAAgB,qBAAM,WAAW,CAAC,gBAAgB,EAAE,EAAA;;wBAAxD,GAAK,YAAY,GAAG,SAAoC,CAAC;;6BAG7D,qBAAM,WAAW,CAAC,OAAO,EAAE,EAAA;;wBAA3B,SAA2B,CAAC;;;wBAGhC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;4BACd,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC;yBACnC;;;;;KACJ;IAED;;OAEG;IACG,qCAAY,GAAlB;;;;;4BAC+B,qBAAM,IAAI,CAAC,0BAA0B,EAAE,EAAA;;wBAA5D,kBAAkB,GAAG,SAAuC;wBAClC,qBAAM,IAAI,CAAC,sBAAsB,EAAE,EAAA;;wBAA7D,KAAA,sBAA0B,SAAmC,KAAA,EAA3D,UAAU,QAAA,EAAE,OAAO,QAAA;wBAErB,iBAAiB,GAAG,IAAI,CAAC,OAAO,CAAC,iBAAiB,KAAK,SAAS,IAAI,IAAI,CAAC,OAAO,CAAC,iBAAiB,CAAC;6BACrG,CAAA,iBAAiB,IAAI,kBAAkB,CAAC,aAAa,CAAA,EAArD,wBAAqD;wBACrD,qBAAM,IAAI,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,UAAU,CAAC,EAAA;;wBAA3D,SAA2D,CAAC;;4BAGhD,qBAAM,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,sBAAsB,CAAC,EAAA;;wBAArE,OAAO,GAAG,SAIf;wBACK,aAAa,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC;wBACrD,IAAI,CAAC,2BAA2B,GAAG,YAAY,CAAC,gBAAgB,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;wBAExF,qBAAM,OAAO,EAAE,EAAA;;wBAAf,SAAe,CAAA;;;;;KAClB;IAEe,yCAAgB,GAAhC,UAAiC,kBAAuB,EAAE,UAAe;;;;;;wBAC7D,MAAM,GAAK,IAAI,CAAC,UAAU,OAApB,CAAqB;wBAG/B,cAAc,GAOd,kBAAkB,eAPJ,EACd,gBAAgB,GAMhB,kBAAkB,iBANF,EAChB,gBAAgB,GAKhB,kBAAkB,iBALF,EAChB,cAAc,GAId,kBAAkB,eAJJ,EACd,kBAAkB,GAGlB,kBAAkB,mBAHA,EAClB,eAAe,GAEf,kBAAkB,gBAFH,EACf,uBAAuB,GACvB,kBAAkB,wBADK,CACJ;6BAEnB,cAAc,EAAd,wBAAc;;;;wBAEV,qBAAM,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,uCAAmC,IAAI,CAAC,OAAO,CAAC,aAAa,IAAI,WAAW,QAAG,CAAC,EAAA;;wBAApH,SAAoH,CAAC;;;;wBAErH,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,6DAA0D,IAAI,CAAC,OAAO,CAAC,aAAa,IAAI,WAAW,yIAAqI,CAAC,CAAC;;;6BAEjQ,gBAAgB,EAAhB,wBAAgB;;;;wBAEZ,qBAAM,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,2CAAyC,CAAC,EAAA;;wBAA9E,SAA8E,CAAC;;;;wBAE/E,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,iKAAiK,CAAC,CAAC;;;6BAE1L,gBAAgB,EAAhB,yBAAgB;;;;wBAEZ,qBAAM,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,2CAAyC,CAAC,EAAA;;wBAA9E,SAA8E,CAAC;;;;wBAE/E,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,iKAAiK,CAAC,CAAC;;;6BAE1L,kBAAkB,EAAlB,yBAAkB;;;;wBAEd,qBAAM,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,4CAA0C,CAAC,EAAA;;wBAA/E,SAA+E,CAAC;;;;wBAEhF,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,sKAAsK,CAAC,CAAC;;;6BAE/L,cAAc,EAAd,yBAAc;;;;wBAEV,qBAAM,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,yCAAuC,CAAC,EAAA;;wBAA5E,SAA4E,CAAC;;;;wBAE7E,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,+JAA+J,CAAC,CAAC;;;6BAExL,eAAe,EAAf,yBAAe;;;;wBAEX,qBAAM,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,0CAAwC,CAAC,EAAA;;wBAA7E,SAA6E,CAAC;;;;wBAE9E,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,gKAAgK,CAAC,CAAC;;;6BAEzL,uBAAuB,EAAvB,yBAAuB;;;;wBAEnB,yFAAyF;wBACzF,qBAAM,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,+CAA6C,CAAC,EAAA;;wBADlF,yFAAyF;wBACzF,SAAkF,CAAC;;;;wBAEnF,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,+KAA+K,CAAC,CAAC;;;;;;KAE/M;IAEe,mDAA0B,GAA1C;;;;;gBACU,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,IAAI,CAAC,UAAA,QAAQ;oBAChE,OAAO,QAAQ,CAAC,gBAAgB,CAAC,MAAM,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,CAAC,kBAAkB,KAAK,MAAM,EAApC,CAAoC,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;gBACvG,CAAC,CAAC,CAAC;gBACG,gBAAgB,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,IAAI,CAAC,UAAA,QAAQ;oBAClE,OAAO,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,CAAC,IAAI,KAAK,QAAQ,EAAxB,CAAwB,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;gBAClF,CAAC,CAAC,CAAC;gBACG,gBAAgB,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,IAAI,CAAC,UAAA,QAAQ;oBAClE,OAAO,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,CAAC,IAAI,KAAK,QAAQ,EAAxB,CAAwB,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;gBAClF,CAAC,CAAC,CAAC;gBACG,cAAc,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,IAAI,CAAC,UAAA,QAAQ;oBAChE,OAAO,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,CAAC,IAAI,KAAK,MAAM,EAAtB,CAAsB,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;gBAChF,CAAC,CAAC,CAAC;gBACG,kBAAkB,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,IAAI,CAAC,UAAA,QAAQ;oBACpE,OAAO,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,UAAA,MAAM,IAAI,OAAA,KAAI,CAAC,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAA3C,CAA2C,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;gBACrG,CAAC,CAAC,CAAC;gBACG,eAAe,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,IAAI,CAAC,UAAA,QAAQ;oBACjE,OAAO,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,UAAA,MAAM,IAAI,OAAA,MAAM,CAAC,IAAI,KAAK,OAAO,EAAvB,CAAuB,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;gBACjF,CAAC,CAAC,CAAC;gBACG,uBAAuB,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,IAAI,CAAC,UAAA,QAAQ;oBACzE,OAAO,QAAQ,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC;gBAC1C,CAAC,CAAC,CAAC;gBAEH,sBAAO;wBACH,cAAc,gBAAA;wBACd,gBAAgB,kBAAA;wBAChB,gBAAgB,kBAAA;wBAChB,cAAc,gBAAA;wBACd,kBAAkB,oBAAA;wBAClB,eAAe,iBAAA;wBACf,uBAAuB,yBAAA;wBACvB,aAAa,EAAE,cAAc,IAAI,gBAAgB,IAAI,gBAAgB,IAAI,kBAAkB,IAAI,cAAc,IAAI,eAAe,IAAI,uBAAuB;qBAC9J,EAAC;;;KACL;IAED;;OAEG;IACG,mCAAU,GAAhB;;;;;;wBACI,IAAI,CAAC,IAAI,CAAC,MAAM;4BACZ,sBAAO,OAAO,CAAC,MAAM,CAAC,IAAI,uBAAuB,CAAC,UAAU,CAAC,CAAC,EAAC;wBAEnE,qBAAM,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,EAAA;;wBAAjC,SAAiC,CAAC;wBAClC,qBAAM,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,UAAA,KAAK,IAAI,OAAA,KAAI,CAAC,SAAS,CAAC,KAAK,CAAC,EAArB,CAAqB,CAAC,CAAC,EAAA;;wBAAlE,SAAkE,CAAC;wBACnE,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC;wBACxB,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;;;;;KACpB;IAED;;OAEG;IACH,4CAAmB,GAAnB;QACI,OAAO,IAAI,kBAAkB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;IACnD,CAAC;IAED;;OAEG;IACH,0CAAiB,GAAjB,UAAkB,IAAqB;QACnC,OAAO,IAAI,mBAAmB,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;IAC/C,CAAC;IAED;;OAEG;IACH,+CAAsB,GAAtB,UAAuB,KAAU,EAAE,cAA8B;QAC7D,IAAI,cAAc,CAAC,WAAW;YAC1B,KAAK,GAAG,sBAAsB,CAAC,WAAW,CAAC,cAAc,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC;QAElF,IAAI,KAAK,KAAK,IAAI,IAAI,KAAK,KAAK,SAAS;YACrC,OAAO,KAAK,CAAC;QAEjB,IAAI,cAAc,CAAC,IAAI,KAAK,OAAO,EAAE;YACjC,OAAO,KAAK,KAAK,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;SAEjC;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,MAAM,EAAE;YACvC,OAAO,SAAS,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC;SAEjD;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,MAAM,EAAE;YACvC,OAAO,SAAS,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC;SAEjD;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,UAAU;eACtC,cAAc,CAAC,IAAI,KAAK,IAAI;eAC5B,cAAc,CAAC,IAAI,KAAK,WAAW;eACnC,cAAc,CAAC,IAAI,KAAK,0BAA0B;eAClD,cAAc,CAAC,IAAI,KAAK,6BAA6B,EAAE;YAC1D,OAAO,SAAS,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;SAE3C;aAAM,IAAI,eAAC,MAAM,EAAE,OAAO,UAAK,IAAI,CAAC,YAAY,UAAE,OAAO,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;YAClF,OAAO,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;SAEhC;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,QAAQ,EAAE;YACzC,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE;gBAC3B,OAAO,KAAK,CAAC;aAChB;iBAAM;gBACH,kDAAkD;gBAClD,IAAM,aAAW,GAAG,UAAC,KAAc;oBAC/B,wFAAwF;oBACxF,4DAA4D;oBAC5D,IAAI,KAAK,KAAK,IAAI,IAAI,OAAO,KAAK,KAAK,WAAW,EAAE;wBAChD,OAAO,MAAM,CAAC;qBACjB;oBACD,6EAA6E;oBAC7E,0FAA0F;oBAC1F,OAAO,OAAI,CAAA,KAAG,KAAO,CAAA,CAAC,OAAO,CAAC,YAAY,EAAE,IAAI,CAAC,OAAG,CAAC;gBACzD,CAAC,CAAC;gBACF,OAAO,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,UAAA,GAAG,IAAI,OAAA,aAAW,CAAC,GAAG,CAAC,GAAG,IAAI,GAAG,aAAW,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAjD,CAAiD,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;aACrG;SAEJ;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,cAAc,EAAE;YAC/C,OAAO,SAAS,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;SAE/C;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,aAAa,EAAE;YAC9C,OAAO,SAAS,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC;SAE9C;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,MAAM,EAAE;YACvC,IAAI,cAAc,CAAC,OAAO,EAAE;gBACxB,OAAO,MAAI,KAAK,CAAC,GAAG,CAAC,UAAC,IAAc,IAAK,OAAA,QAAK,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,QAAI,EAAvB,CAAuB,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,MAAG,CAAC;aAClF;YACD,OAAO,MAAI,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,MAAG,CAAC;SAEjC;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,OAAO,EAAE;YACxC,OAAO,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;SAC5E;aAAM,IACH,CACI,cAAc,CAAC,IAAI,KAAK,MAAM;eAC3B,cAAc,CAAC,IAAI,KAAK,aAAa,CAC3C;eACE,CAAC,cAAc,CAAC,OAAO,EAC5B;YACE,OAAO,EAAE,GAAG,KAAK,CAAC;SACrB;QAED,OAAO,KAAK,CAAC;IACjB,CAAC;IAED;;OAEG;IACH,6CAAoB,GAApB,UAAqB,KAAU,EAAE,cAA8B;QAC3D,IAAI,KAAK,KAAK,IAAI,IAAI,KAAK,KAAK,SAAS;YACrC,OAAO,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC,sBAAsB,CAAC,aAAa,CAAC,cAAc,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;QAExH,IAAI,cAAc,CAAC,IAAI,KAAK,OAAO,EAAE;YACjC,KAAK,GAAG,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC;SAEhC;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,UAAU;eACtC,cAAc,CAAC,IAAI,KAAK,IAAI;eAC5B,cAAc,CAAC,IAAI,KAAK,WAAW;eACnC,cAAc,CAAC,IAAI,KAAK,0BAA0B;eAClD,cAAc,CAAC,IAAI,KAAK,6BAA6B,EAAE;YAC1D,KAAK,GAAG,SAAS,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC;SAElD;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,MAAM,EAAE;YACvC,KAAK,GAAG,SAAS,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC;SAElD;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,MAAM,EAAE;YACvC,KAAK,GAAG,SAAS,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;SAE9C;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,QAAQ,EAAE;YACzC,IAAI,cAAc,CAAC,UAAU,KAAK,QAAQ,EAAE;gBACxC,IAAM,gBAAc,GAAG,UAAC,GAAW,IAAK,OAAA,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,UAAC,CAAC,IAAK,OAAA,CAAC,CAAC,CAAC,CAAC,EAAJ,CAAI,CAAC,EAAhC,CAAgC,CAAC;gBACzE,IAAM,MAAM,GAAG,2EAA2E,CAAC;gBAC3F,IAAM,QAAM,GAAkB,EAAE,CAAC;gBACjC,CAAA,KAAG,KAAO,CAAA,CAAC,OAAO,CAAC,MAAM,EAAE,UAAC,CAAC,EAAE,GAAG,EAAE,SAAS,EAAE,WAAW;oBACtD,QAAM,CAAC,gBAAc,CAAC,GAAG,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,gBAAc,CAAC,WAAW,CAAC,CAAC;oBAC7E,OAAO,EAAE,CAAC;gBACd,CAAC,CAAC,CAAC;gBACH,OAAO,QAAM,CAAC;aAEjB;iBAAM;gBACH,OAAO,KAAK,CAAC;aAChB;SAEJ;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,cAAc,EAAE;YAC/C,KAAK,GAAG,SAAS,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;SAEhD;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,aAAa,EAAE;YAC9C,KAAK,GAAG,SAAS,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC;SAE/C;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,MAAM,EAAE;YACvC,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC,CAAC,CAAC,oBAAoB;YAC7D,IAAI,cAAc,CAAC,OAAO,EAAE;gBACxB;;;;;mBAKG;gBACH,IAAM,MAAM,GAAG,sCAAsC,CAAC;gBACtD,IAAM,mBAAmB,GAAG,KAAK,CAAC;gBAElC,KAAK,GAAG,EAAE,CAAC;gBACX,IAAI,IAAI,GAA2B,IAAI,CAAC;gBACxC,6DAA6D;gBAC7D,OAAO,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,KAAK,IAAI,EAAE;oBACvD,IAAI,IAAI,CAAC,CAAC,CAAC,KAAK,SAAS,EAAE;wBACvB,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC;qBAC9D;yBAAM;wBACH,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;qBACzB;iBACJ;aACJ;iBAAM;gBACH,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;aACxD;SAEJ;aAAM,IAAI,cAAc,CAAC,IAAI,KAAK,MAAM,IAAI,cAAc,CAAC,IAAI,KAAK,aAAa,EAAG;YACjF,IAAI,cAAc,CAAC,OAAO,EAAE;gBACxB,IAAI,KAAK,KAAK,IAAI;oBAAE,OAAO,EAAE,CAAC;gBAE9B,8HAA8H;gBAC9H,KAAK,GAAI,KAAgB,CAAC,MAAM,CAAC,CAAC,EAAG,KAAgB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,UAAA,GAAG;oBAChF,4DAA4D;oBAC5D,IAAI,GAAG,CAAC,UAAU,CAAC,IAAG,CAAC,IAAI,GAAG,CAAC,QAAQ,CAAC,IAAG,CAAC;wBAAE,GAAG,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;oBACrE,qEAAqE;oBACrE,GAAG,GAAG,GAAG,CAAC,OAAO,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;oBACnC,qEAAqE;oBACrE,OAAO,GAAG,CAAC,OAAO,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;gBACtC,CAAC,CAAC,CAAC;gBAEH,4DAA4D;gBAC5D,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,UAAC,GAAW;oBAC1B,OAAO,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,IAAI,cAAc,CAAC,IAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;gBAClG,CAAC,CAAC,CAAC;aACN;iBAAM;gBACH,4DAA4D;gBAC5D,KAAK,GAAG,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,IAAI,cAAc,CAAC,IAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;aAC1G;SACJ;QAED,IAAI,cAAc,CAAC,WAAW;YAC1B,KAAK,GAAG,sBAAsB,CAAC,aAAa,CAAC,cAAc,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC;QACpF,OAAO,KAAK,CAAC;IACjB,CAAC;IAED;;;OAGG;IACH,kDAAyB,GAAzB,UAA0B,GAAW,EAAE,UAAyB,EAAE,gBAA+B;QAAjG,iBA4BC;QA3BG,IAAM,iBAAiB,GAAU,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,GAAG,CAAC,UAAA,GAAG,IAAI,OAAA,gBAAgB,CAAC,GAAG,CAAC,EAArB,CAAqB,CAAC,CAAC;QACjG,IAAI,CAAC,UAAU,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,MAAM;YAC9C,OAAO,CAAC,GAAG,EAAE,iBAAiB,CAAC,CAAC;QAEpC,GAAG,GAAG,GAAG,CAAC,OAAO,CAAC,6BAA6B,EAAE,UAAC,IAAI,EAAE,OAAe,EAAE,GAAW;YAChF,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;gBACjC,OAAO,IAAI,CAAC;aACf;YAED,IAAI,KAAK,GAAQ,UAAU,CAAC,GAAG,CAAC,CAAC;YAEjC,IAAI,OAAO,EAAE;gBACT,OAAO,KAAK,CAAC,GAAG,CAAC,UAAC,CAAM;oBACpB,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;oBAC1B,OAAO,KAAI,CAAC,eAAe,CAAC,GAAG,EAAE,iBAAiB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;gBACnE,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aAEjB;YAED,IAAI,KAAK,YAAY,QAAQ,EAAE;gBAC3B,OAAO,KAAK,EAAE,CAAC;aAClB;YAED,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YAC9B,OAAO,KAAI,CAAC,eAAe,CAAC,GAAG,EAAE,iBAAiB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QACnE,CAAC,CAAC,CAAC,CAAC,kEAAkE;QACtE,OAAO,CAAC,GAAG,EAAE,iBAAiB,CAAC,CAAC;IACpC,CAAC;IAED;;OAEG;IACH,+BAAM,GAAN,UAAO,UAAkB;QACrB,OAAO,IAAI,GAAG,UAAU,GAAG,IAAI,CAAC;IACpC,CAAC;IAED;;;OAGG;IACH,uCAAc,GAAd,UAAe,SAAiB,EAAE,MAAe;QAC7C,IAAI,SAAS,GAAG,CAAE,SAAS,CAAE,CAAC;QAE9B,IAAI,MAAM,EAAE;YACR,SAAS,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;SAC7B;QAED,OAAO,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAC/B,CAAC;IAED;;OAEG;IACH,uCAAc,GAAd,UAAe,MAAgE;QAC3E,IAAM,cAAc,GAAG,IAAI,CAAC,QAAQ,CAAC;QACrC,IAAM,YAAY,GAAG,IAAI,CAAC,MAAM,CAAC;QAEjC,IAAI,MAAM,YAAY,KAAK,IAAI,MAAM,YAAY,IAAI,EAAE;YACnD,IAAM,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YAEhD,OAAO;gBACH,QAAQ,EAAE,MAAM,CAAC,QAAQ,IAAI,MAAM,CAAC,QAAQ,IAAI,cAAc;gBAC9D,MAAM,EAAE,MAAM,CAAC,MAAM,IAAI,MAAM,CAAC,MAAM,IAAI,YAAY;gBACtD,SAAS,EAAE,MAAM,CAAC,SAAS;aAC9B,CAAC;SACL;QAED,IAAI,MAAM,YAAY,eAAe,EAAE;YACnC,IAAM,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAAC;YAE/D,OAAO;gBACH,QAAQ,EAAE,MAAM,CAAC,kBAAkB,IAAI,MAAM,CAAC,QAAQ,IAAI,cAAc;gBACxE,MAAM,EAAE,MAAM,CAAC,gBAAgB,IAAI,MAAM,CAAC,MAAM,IAAI,YAAY;gBAChE,SAAS,EAAE,MAAM,CAAC,SAAS;aAC9B,CAAC;SACL;QAED,IAAI,MAAM,YAAY,cAAc,EAAE;YAClC,2CAA2C;YAE3C,OAAO;gBACH,QAAQ,EAAE,MAAM,CAAC,QAAQ,IAAI,cAAc;gBAC3C,MAAM,EAAE,MAAM,CAAC,MAAM,IAAI,YAAY;gBACrC,SAAS,EAAE,MAAM,CAAC,SAAS;aAC9B,CAAC;SAEL;QAED,IAAM,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAEhC,OAAO;YACH,QAAQ,EAAE,cAAc;YACxB,MAAM,EAAE,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,IAAI,YAAY;YACjE,SAAS,EAAE,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;SACpD,CAAC;IACN,CAAC;IAED;;OAEG;IACH,sCAAa,GAAb,UAAc,MAAmH;QAC7H,IAAI,MAAM,CAAC,IAAI,KAAK,MAAM,IAAI,MAAM,CAAC,IAAI,KAAK,KAAK,IAAI,MAAM,CAAC,IAAI,KAAK,MAAM,EAAE;YAC3E,OAAO,SAAS,CAAC;SAEpB;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,MAAM,IAAI,MAAM,CAAC,IAAI,KAAK,SAAS,EAAE;YAC5D,OAAO,mBAAmB,CAAC;SAE9B;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,IAAI,IAAI,MAAM,CAAC,IAAI,KAAK,WAAW,EAAE;YAC5D,OAAO,6BAA6B,CAAC;SAExC;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,aAAa,EAAE;YACtC,OAAO,0BAA0B,CAAC;SAErC;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,MAAM,EAAE;YAC/B,OAAO,wBAAwB,CAAC;SAEnC;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,QAAQ,EAAE;YACjC,OAAO,qBAAqB,CAAC;SAEhC;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,OAAO,IAAI,MAAM,CAAC,IAAI,KAAK,MAAM,EAAE;YAC1D,OAAO,SAAS,CAAC;SAEpB;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,cAAc,EAAE;YACvC,OAAO,MAAM,CAAC;SAEjB;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,aAAa,EAAE;YACtC,OAAO,MAAM,CAAC;SAEjB;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,aAAa,EAAE;YACtC,OAAO,MAAM,CAAC;SAEjB;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,MAAM,EAAE;YAC/B,OAAO,UAAU,CAAC;SAErB;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,MAAM,EAAE;YAC/B,OAAO,QAAQ,CAAC;SAEnB;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,SAAS,EAAE;YAClC,OAAO,SAAS,CAAC;SAEpB;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,QAAQ,IAAI,MAAM,CAAC,IAAI,KAAK,OAAO,EAAE;YAC5D,OAAO,kBAAkB,CAAC;SAE7B;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,QAAQ,EAAE;YACjC,OAAO,MAAM,CAAC;SAEjB;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,MAAM,EAAE;YAC/B,OAAO,WAAW,CAAC;SAEtB;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,QAAQ,EAAE;YACjC,OAAO,aAAa,CAAC;SAExB;aAAM;YACH,OAAO,MAAM,CAAC,IAAc,IAAI,EAAE,CAAC;SACtC;IACL,CAAC;IAED;;OAEG;IACH,yCAAgB,GAAhB,UAAiB,cAA8B;QAC3C,IAAM,YAAY,GAAG,cAAc,CAAC,OAAO,CAAC;QAE5C,IAAI,YAAY,KAAK,IAAI,EAAE;YACvB,OAAO,SAAS,CAAC;SACpB;QAED,IAAI,cAAc,CAAC,OAAO,IAAI,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE;YACvD,OAAO,OAAK,YAAY,CAAC,GAAG,CAAC,UAAC,GAAW,IAAK,OAAA,KAAG,GAAK,EAAR,CAAQ,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,OAAI,CAAC;SACzE;QAED,IACI,CAAC,cAAc,CAAC,IAAI,KAAK,MAAM;eAC5B,cAAc,CAAC,IAAI,KAAK,aAAa;eACrC,OAAO,YAAY,KAAK,QAAQ;eAChC,OAAO,YAAY,KAAK,QAAQ,CAAC;eACjC,YAAY,KAAK,SAAS,EAC/B;YACE,OAAO,MAAI,YAAY,MAAG,CAAC;SAC9B;QAED,IAAI,OAAO,YAAY,KAAK,SAAS,EAAE;YACnC,OAAO,YAAY,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC;SAC1C;QAED,IAAI,OAAO,YAAY,KAAK,UAAU,EAAE;YACpC,IAAM,KAAK,GAAG,YAAY,EAAE,CAAC;YAE7B,OAAO,IAAI,CAAC,yBAAyB,CAAC,KAAK,CAAC,CAAC;SAChD;QAED,IAAI,OAAO,YAAY,KAAK,QAAQ,EAAE;YAClC,OAAO,MAAI,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,MAAG,CAAC;SAC9C;QAED,IAAI,YAAY,KAAK,SAAS,EAAE;YAC5B,OAAO,SAAS,CAAC;SACpB;QAED,OAAO,KAAG,YAAc,CAAC;IAC7B,CAAC;IAED;;;OAGG;IACK,qCAAY,GAApB,UAAqB,cAA8B,EAAE,WAAwB;QACzE,IACI,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,QAAQ,CAAC,cAAc,CAAC,IAAc,CAAC;eACtD,CAAC,CAAC,UAAU,EAAE,WAAW,CAAC,CAAC,QAAQ,CAAC,OAAO,cAAc,CAAC,OAAO,CAAC,EACvE;YACE,IAAM,kBAAkB,GAAG,OAAO,WAAW,CAAC,OAAO,KAAK,QAAQ,CAAC,CAAC;gBAChE,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,EAAE,WAAW,CAAC,OAAO,CAAC,MAAM,GAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBAC5E,WAAW,CAAC,OAAO,CAAC;YAExB,OAAO,QAAQ,CAAC,WAAW,CAAC,cAAc,CAAC,OAAO,EAAE,kBAAkB,CAAC,CAAC;SAC3E;QAED,IAAM,aAAa,GAAG,IAAI,CAAC,4BAA4B,CAAC,IAAI,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC,CAAC;QAC/F,OAAO,aAAa,KAAK,WAAW,CAAC,OAAO,CAAC;IACjD,CAAC;IAED;;OAEG;IACH,0CAAiB,GAAjB,UAAkB,MAAsB;QACpC,OAAO,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,UAAA,EAAE,IAAI,OAAA,EAAE,CAAC,OAAO,CAAC,MAAM,KAAK,CAAC,IAAI,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,MAAM,EAAnD,CAAmD,CAAC,CAAC;IACzG,CAAC;IAED;;OAEG;IACH,wCAAe,GAAf,UAAgB,MAAsB;QAClC,OAAO,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;IACzD,CAAC;IAED;;OAEG;IACH,uCAAc,GAAd,UAAe,MAAmB;QAC9B,IAAI,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;QAEvB,IAAI,MAAM,CAAC,MAAM,EAAE;YACf,IAAI,IAAI,GAAG,GAAG,MAAM,CAAC,MAAM,GAAG,GAAG,CAAC;SACrC;aAAM,IAAI,MAAM,CAAC,SAAS,KAAK,IAAI,IAAI,MAAM,CAAC,SAAS,KAAK,SAAS,IAAI,MAAM,CAAC,KAAK,KAAK,IAAI,IAAI,MAAM,CAAC,KAAK,KAAK,SAAS,EAAE;YAC3H,IAAI,IAAI,GAAG,GAAG,MAAM,CAAC,SAAS,GAAG,GAAG,GAAG,MAAM,CAAC,KAAK,GAAG,GAAG,CAAC;SAC7D;aAAM,IAAI,MAAM,CAAC,SAAS,KAAK,IAAI,IAAI,MAAM,CAAC,SAAS,KAAK,SAAS,EAAE;YACpE,IAAI,IAAK,GAAG,GAAG,MAAM,CAAC,SAAS,GAAG,GAAG,CAAC;SACzC;QAED,IAAI,MAAM,CAAC,IAAI,KAAK,wBAAwB,EAAE;YAC1C,IAAI,GAAG,MAAM,GAAG,CAAC,MAAM,CAAC,SAAS,KAAK,IAAI,IAAI,MAAM,CAAC,SAAS,KAAK,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG,MAAM,CAAC,SAAS,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;SAErH;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,qBAAqB,EAAE;YAC9C,IAAI,GAAG,MAAM,GAAG,CAAC,MAAM,CAAC,SAAS,KAAK,IAAI,IAAI,MAAM,CAAC,SAAS,KAAK,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG,MAAM,CAAC,SAAS,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,iBAAiB,CAAC;SAEzI;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,6BAA6B,EAAE;YACtD,IAAI,GAAG,WAAW,GAAG,CAAC,MAAM,CAAC,SAAS,KAAK,IAAI,IAAI,MAAM,CAAC,SAAS,KAAK,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG,MAAM,CAAC,SAAS,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;SAE1H;aAAM,IAAI,MAAM,CAAC,IAAI,KAAK,0BAA0B,EAAE;YACnD,IAAI,GAAG,WAAW,GAAG,CAAC,MAAM,CAAC,SAAS,KAAK,IAAI,IAAI,MAAM,CAAC,SAAS,KAAK,SAAS,CAAC,CAAC,CAAC,GAAG,GAAG,MAAM,CAAC,SAAS,GAAG,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,iBAAiB,CAAC;SAC9I;aAAM,IAAI,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC,IAAkB,CAAC,IAAI,CAAC,EAAE;YAClE,IAAI,MAAM,CAAC,kBAAkB,IAAI,IAAI,IAAI,MAAM,CAAC,IAAI,IAAI,IAAI,EAAE;gBAC1D,IAAI,GAAM,MAAM,CAAC,IAAI,SAAI,MAAM,CAAC,kBAAkB,SAAI,MAAM,CAAC,IAAI,MAAG,CAAC;aACxE;iBAAM,IAAI,MAAM,CAAC,kBAAkB,IAAI,IAAI,EAAE;gBAC1C,IAAI,GAAM,MAAM,CAAC,IAAI,SAAI,MAAM,CAAC,kBAAkB,MAAG,CAAC;aACzD;iBAAM;gBACH,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;aACtB;SACJ;QAED,IAAI,MAAM,CAAC,OAAO;YACd,IAAI,IAAI,QAAQ,CAAC;QAErB,OAAO,IAAI,CAAC;IAChB,CAAC;IAED;;;;OAIG;IACG,+CAAsB,GAA5B;;;;gBACI,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;oBACd,MAAM,IAAI,YAAY,CAAC,sBAAsB,CAAC,CAAC;iBAClD;gBAED,sBAAO,IAAI,OAAO,CAAC,UAAC,EAAE,EAAE,IAAI;wBACxB,KAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAC,GAAQ,EAAE,UAAe,EAAE,OAAY;4BACxD,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC,CAAC;wBAChD,CAAC,CAAC,CAAC;oBACP,CAAC,CAAC,EAAC;;;KACN;IAED;;;;OAIG;IACG,8CAAqB,GAA3B;;;;;gBACI,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE;oBACrB,sBAAO,IAAI,CAAC,sBAAsB,EAAE,EAAC;iBACxC;gBAEK,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;gBAE9D,sBAAO,IAAI,OAAO,CAAC,UAAC,EAAE,EAAE,IAAI;wBACxB,KAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,UAAC,GAAQ,EAAE,UAAe,EAAE,OAAY;4BAChE,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC,CAAC;wBAChD,CAAC,CAAC,CAAC;oBACP,CAAC,CAAC,EAAC;;;KACN;IAED;;;;OAIG;IACH,2CAAkB,GAAlB,UAAmB,QAAwB,EAAE,YAA2B;QACpE,IAAI,CAAC,YAAY;YACb,OAAO,SAAS,CAAC;QAErB,OAAO,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,MAAM,CAAC,UAAC,GAAG,EAAE,GAAG;YAC7C,IAAM,MAAM,GAAG,QAAQ,CAAC,0BAA0B,CAAC,GAAG,CAAC,CAAC;YACxD,IAAI,MAAM,EAAE;gBACR,QAAQ,CAAC,SAAS,CAAC,GAAG,EAAE,MAAM,CAAC,cAAc,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;gBAClE,8KAA8K;aACjL;YACD,OAAO,GAAG,CAAC;QACf,CAAC,EAAE,EAAmB,CAAC,CAAC;IAC5B,CAAC;IAED;;;OAGG;IACH,2CAAkB,GAAlB,UAAmB,YAA2B,EAAE,eAAiC;QAAjF,iBAiDC;QAhDG,OAAO,eAAe,CAAC,MAAM,CAAC,UAAA,cAAc;YACxC,IAAM,WAAW,GAAG,YAAY,CAAC,IAAI,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,IAAI,KAAK,cAAc,CAAC,YAAY,EAAtC,CAAsC,CAAC,CAAC;YACnF,IAAI,CAAC,WAAW;gBACZ,OAAO,KAAK,CAAC,CAAC,4DAA4D;YAE9E,IAAM,eAAe,GAAG,WAAW,CAAC,IAAI,KAAK,cAAc,CAAC,YAAY;mBACjE,WAAW,CAAC,IAAI,KAAK,KAAI,CAAC,aAAa,CAAC,cAAc,CAAC;mBACvD,WAAW,CAAC,MAAM,KAAK,cAAc,CAAC,MAAM;mBAC5C,WAAW,CAAC,OAAO,KAAK,cAAc,CAAC,OAAO;mBAC9C,WAAW,CAAC,SAAS,KAAK,cAAc,CAAC,SAAS;mBAClD,CAAC,cAAc,CAAC,KAAK,KAAK,SAAS,IAAI,WAAW,CAAC,KAAK,KAAK,cAAc,CAAC,KAAK,CAAC;mBAClF,WAAW,CAAC,OAAO,KAAK,KAAI,CAAC,aAAa,CAAC,cAAc,CAAC,OAAO,CAAC;mBAClE,CAAC,CAAC,WAAW,CAAC,WAAW,IAAI,CAAC,KAAI,CAAC,YAAY,CAAC,cAAc,EAAE,WAAW,CAAC,CAAC,CAAC,kGAAkG;mBAChL,WAAW,CAAC,SAAS,KAAK,cAAc,CAAC,SAAS;mBAClD,WAAW,CAAC,UAAU,KAAK,cAAc,CAAC,UAAU;mBACpD,WAAW,CAAC,QAAQ,KAAK,KAAI,CAAC,iBAAiB,CAAC,cAAc,CAAC;mBAC/D,WAAW,CAAC,QAAQ,KAAK,cAAc,CAAC,QAAQ;mBAChD,CAAC,WAAW,CAAC,IAAI,IAAI,cAAc,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,WAAW,CAAC,IAAI,EAAE,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,UAAA,GAAG,IAAI,OAAA,GAAG,GAAG,EAAE,EAAR,CAAQ,CAAC,CAAC,CAAC,CAAC,uCAAuC;mBACxK,WAAW,CAAC,WAAW,KAAK,cAAc,CAAC,WAAW;mBACtD,CAAC,WAAW,CAAC,kBAAkB,IAAI,EAAE,CAAC,CAAC,WAAW,EAAE,KAAK,CAAC,cAAc,CAAC,kBAAkB,IAAI,EAAE,CAAC,CAAC,WAAW,EAAE;mBAChH,WAAW,CAAC,IAAI,KAAK,cAAc,CAAC,IAAI;mBACxC,WAAW,CAAC,aAAa,KAAK,cAAc,CAAC,aAAa;mBAC1D,CAAC,WAAW,CAAC,YAAY,IAAI,EAAE,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,cAAc,CAAC,YAAY,IAAI,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;YAE9F,gBAAgB;YAChB,yBAAyB;YACzB,sEAAsE;YACtE,2EAA2E;YAC3E,kFAAkF;YAClF,yEAAyE;YACzE,4EAA4E;YAC5E,kFAAkF;YAClF,sEAAsE;YACtE,gGAAgG;YAChG,+EAA+E;YAC/E,4JAA4J;YAC5J,kFAAkF;YAClF,qFAAqF;YACrF,8FAA8F;YAC9F,wFAAwF;YACxF,mKAAmK;YACnK,yJAAyJ;YACzJ,kEAAkE;YAClE,iEAAiE;YACjE,IAAI;YAEJ,OAAO,eAAe,CAAC;QAC3B,CAAC,CAAC,CAAC;IACP,CAAC;IAEO,qDAA4B,GAApC,UAAqC,KAAyB;QAC1D,oEAAoE;QACpE,IAAI,CAAC,KAAK,EAAE;YACR,OAAO,KAAK,CAAC;SAChB;QACD,OAAO,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,UAAC,CAAC,EAAE,CAAC;YAC7B,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC;QAC7C,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACjB,CAAC;IAED;;OAEG;IACH,gDAAuB,GAAvB;QACI,OAAO,IAAI,CAAC;IAChB,CAAC;IAED;;OAEG;IACH,kDAAyB,GAAzB;QACI,OAAO,IAAI,CAAC;IAChB,CAAC;IAED;;OAEG;IACH,sDAA6B,GAA7B;QACI,OAAO,KAAK,CAAC;IACjB,CAAC;IAED,sBAAI,yCAAa;aAAjB;YACI,OAAO,IAAI,CAAC,OAAO,CAAC,aAAa,KAAK,UAAU,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC,oBAAoB,CAAC;QAClG,CAAC;;;OAAA;IAED;;OAEG;IACH,wCAAe,GAAf,UAAgB,aAAqB,EAAE,KAAa;QAChD,OAAO,GAAG,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;IAC7B,CAAC;IAED,4EAA4E;IAC5E,iBAAiB;IACjB,4EAA4E;IAE5E;;OAEG;IACH,6CAAoB,GAApB;QACI,IAAI;YACA,OAAO,aAAa,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;SAEhD;QAAC,OAAO,CAAC,EAAE,EAAE,qCAAqC;YAC/C,MAAM,IAAI,YAAY,CAAC,6GAA6G,CAAC,CAAC;SACzI;IACL,CAAC;IAED,4EAA4E;IAC5E,oBAAoB;IACpB,4EAA4E;IAE5E;;OAEG;IACO,yCAAgB,GAA1B;QACI,IAAI;YACA,IAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACjE,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;YACzB,IAAI;gBACA,IAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,IAAI,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;gBAC9E,IAAI,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM;oBAAE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;aAE9E;YAAC,OAAO,CAAC,EAAE,GAAG;SAElB;QAAC,OAAO,CAAC,EAAE,EAAE,qCAAqC;YAC/C,MAAM,IAAI,8BAA8B,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;SAC9D;IACL,CAAC;IAED;;OAEG;IACa,mCAAU,GAA1B,UAA2B,OAAkC,EAAE,WAAiD;;;;;gBAE5G,WAAW,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,WAAW,CAAC,CAAC;gBAIvC,iBAAiB,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE;oBACxC,gBAAgB,EAAE,WAAW,CAAC,GAAG;oBACjC,IAAI,EAAE,WAAW,CAAC,IAAI;oBACtB,IAAI,EAAE,WAAW,CAAC,QAAQ;oBAC1B,QAAQ,EAAE,WAAW,CAAC,QAAQ;oBAC9B,QAAQ,EAAE,WAAW,CAAC,QAAQ;oBAC9B,IAAI,EAAE,WAAW,CAAC,IAAI;oBACtB,GAAG,EAAE,WAAW,CAAC,GAAG;oBACpB,uBAAuB,EAAE,OAAO,CAAC,gBAAgB;oBACjD,gBAAgB,EAAE,OAAO,CAAC,eAAe;iBAC5C,EAAE,OAAO,CAAC,KAAK,IAAI,EAAE,CAAC,CAAC;gBAGlB,IAAI,GAAG,IAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;gBAC/C,MAAM,GAAK,IAAI,CAAC,UAAU,OAApB,CAAqB;gBAE7B,gBAAgB,GAAG,OAAO,CAAC,gBAAgB,IAAI,CAAC,UAAC,KAAU,IAAK,OAAA,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,oCAAkC,KAAO,CAAC,EAA7D,CAA6D,CAAC,CAAC;gBAErI;;;mBAGG;gBACH,IAAI,CAAC,EAAE,CAAC,OAAO,EAAE,gBAAgB,CAAC,CAAC;gBAEnC,sBAAO,IAAI,OAAO,CAAC,UAAC,EAAE,EAAE,IAAI;wBACxB,IAAI,CAAC,OAAO,CAAC,UAAC,GAAQ,EAAE,UAAe,EAAE,OAAiB;4BACtD,IAAI,GAAG;gCAAE,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC;4BAE1B,IAAI,OAAO,CAAC,gBAAgB,EAAE;gCAC1B,UAAU,CAAC,EAAE,CAAC,QAAQ,EAAE,UAAC,GAAQ;oCAC7B,GAAG,IAAI,KAAI,CAAC,UAAU,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,OAAO,CAAC,CAAC;gCAC3D,CAAC,CAAC,CAAC;gCACH,UAAU,CAAC,EAAE,CAAC,cAAc,EAAE,UAAC,GAAQ;oCACnC,GAAG,IAAI,KAAI,CAAC,UAAU,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,gCAA8B,GAAG,CAAC,OAAO,UAAK,GAAG,CAAC,OAAO,MAAG,CAAC,CAAC;gCAC5G,CAAC,CAAC,CAAC;6BACN;4BACD,OAAO,EAAE,CAAC;4BACV,EAAE,CAAC,IAAI,CAAC,CAAC;wBACb,CAAC,CAAC,CAAC;oBACP,CAAC,CAAC,EAAC;;;KACN;IAED;;OAEG;IACa,kCAAS,GAAzB,UAA0B,IAAS;;;;;6BACxB,IAAI,CAAC,qBAAqB,CAAC,MAAM;wBACpC,qBAAM,IAAI,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,EAAA;;wBAA7C,SAA6C,CAAC;;4BAGlD,sBAAO,IAAI,OAAO,CAAO,UAAC,EAAE,EAAE,IAAI;4BAC9B,IAAI,CAAC,GAAG,CAAC,UAAC,GAAQ,IAAK,OAAA,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,EAAtB,CAAsB,CAAC,CAAC;wBACnD,CAAC,CAAC,EAAC;;;;KACN;IAED;;OAEG;IACO,qCAAY,GAAtB,UAAuB,UAAe,EAAE,KAAa;QACjD,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QAEvC,OAAO,IAAI,OAAO,CAAC,UAAC,EAAE,EAAE,IAAI;YACxB,UAAU,CAAC,KAAK,CAAC,KAAK,EAAE,UAAC,GAAQ,EAAE,MAAW,IAAK,OAAA,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,EAA5B,CAA4B,CAAC,CAAC;QACrF,CAAC,CAAC,CAAC;IACP,CAAC;IAED;;;OAGG;IACO,kDAAyB,GAAnC,UAAoC,KAAa;QAC7C,sCAAsC;QACtC,IAAM,cAAc,GAAG,KAAK,CAAC,WAAW,EAAE,CAAC;QAC3C,IAAM,kBAAkB,GAAG,cAAc,CAAC,OAAO,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;eACtE,cAAc,CAAC,OAAO,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;eAC7C,cAAc,CAAC,OAAO,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;eAC7C,cAAc,CAAC,OAAO,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;eAC/C,cAAc,CAAC,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC;QAElD,IAAI,kBAAkB,EAAE;YACpB,gCAAgC;YAChC,IAAM,SAAS,GAAG,KAAK,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC;YAEzC,IAAI,cAAc,CAAC,OAAO,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC,EAAE;gBACpD,OAAO,SAAS,CAAC,CAAC,CAAC,6BAA2B,SAAS,CAAC,CAAC,CAAC,oBAAiB,CAAC,CAAC,CAAC,OAAO,CAAC;aAEzF;iBAAM,IAAI,cAAc,KAAK,cAAc,EAAE;gBAC1C,OAAO,qBAAqB,CAAC;aAEhC;iBAAM,IAAI,cAAc,CAAC,OAAO,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC,EAAE;gBACtD,OAAO,SAAS,CAAC,CAAC,CAAC,wBAAsB,SAAS,CAAC,CAAC,CAAC,oBAAiB,CAAC,CAAC,CAAC,oCAAoC,CAAC;aAEjH;iBAAM,IAAI,cAAc,CAAC,OAAO,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC,EAAE;gBACxD,OAAO,SAAS,CAAC,CAAC,CAAC,6BAA2B,SAAS,CAAC,CAAC,CAAC,uBAAoB,CAAC,CAAC,CAAC,4CAA4C,CAAC;aAEjI;iBAAM,IAAI,cAAc,CAAC,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE;gBACnD,OAAO,SAAS,CAAC,CAAC,CAAC,wBAAsB,SAAS,CAAC,CAAC,CAAC,uBAAoB,CAAC,CAAC,CAAC,uCAAuC,CAAC;aACvH;SACJ;QAED,OAAO,KAAK,CAAC;IACjB,CAAC;IAED;;OAEG;IACO,sCAAa,GAAvB,UAAwB,OAAgB;QACpC,IAAI,CAAC,OAAO;YAAE,OAAO,OAAO,CAAC;QAE7B,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC,CAAC,wCAAwC;QAElF,OAAO,OAAO,CAAC;IACnB,CAAC;IAEL,qBAAC;AAAD,CA/sCA,AA+sCC,IAAA","file":"PostgresDriver.js","sourcesContent":["import {ObjectLiteral} from \"../../common/ObjectLiteral\";\r\nimport {Connection} from \"../../connection/Connection\";\r\nimport {ConnectionIsNotSetError} from \"../../error/ConnectionIsNotSetError\";\r\nimport {DriverPackageNotInstalledError} from \"../../error/DriverPackageNotInstalledError\";\r\nimport {ColumnMetadata} from \"../../metadata/ColumnMetadata\";\r\nimport {EntityMetadata} from \"../../metadata/EntityMetadata\";\r\nimport {PlatformTools} from \"../../platform/PlatformTools\";\r\nimport {QueryRunner} from \"../../query-runner/QueryRunner\";\r\nimport {RdbmsSchemaBuilder} from \"../../schema-builder/RdbmsSchemaBuilder\";\r\nimport {TableColumn} from \"../../schema-builder/table/TableColumn\";\r\nimport {ApplyValueTransformers} from \"../../util/ApplyValueTransformers\";\r\nimport {DateUtils} from \"../../util/DateUtils\";\r\nimport {OrmUtils} from \"../../util/OrmUtils\";\r\nimport {Driver} from \"../Driver\";\r\nimport {ColumnType} from \"../types/ColumnTypes\";\r\nimport {DataTypeDefaults} from \"../types/DataTypeDefaults\";\r\nimport {MappedColumnTypes} from \"../types/MappedColumnTypes\";\r\nimport {ReplicationMode} from \"../types/ReplicationMode\";\r\nimport {VersionUtils} from \"../../util/VersionUtils\";\r\nimport {PostgresConnectionCredentialsOptions} from \"./PostgresConnectionCredentialsOptions\";\r\nimport {PostgresConnectionOptions} from \"./PostgresConnectionOptions\";\r\nimport {PostgresQueryRunner} from \"./PostgresQueryRunner\";\r\nimport {DriverUtils} from \"../DriverUtils\";\r\nimport { TypeORMError } from \"../../error\";\r\nimport { Table } from \"../../schema-builder/table/Table\";\r\nimport { View } from \"../../schema-builder/view/View\";\r\nimport { TableForeignKey } from \"../../schema-builder/table/TableForeignKey\";\r\n\r\n/**\r\n * Organizes communication with PostgreSQL DBMS.\r\n */\r\nexport class PostgresDriver implements Driver {\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Properties\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Connection used by driver.\r\n     */\r\n    connection: Connection;\r\n\r\n    /**\r\n     * Postgres underlying library.\r\n     */\r\n    postgres: any;\r\n\r\n    /**\r\n     * Pool for master database.\r\n     */\r\n    master: any;\r\n\r\n    /**\r\n     * Pool for slave databases.\r\n     * Used in replication.\r\n     */\r\n    slaves: any[] = [];\r\n\r\n    /**\r\n     * We store all created query runners because we need to release them.\r\n     */\r\n    connectedQueryRunners: QueryRunner[] = [];\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Implemented Properties\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Connection options.\r\n     */\r\n    options: PostgresConnectionOptions;\r\n\r\n    /**\r\n     * Database name used to perform all write queries.\r\n     */\r\n    database?: string;\r\n\r\n    /**\r\n     * Schema name used to perform all write queries.\r\n     */\r\n    schema?: string;\r\n\r\n    /**\r\n     * Schema that's used internally by Postgres for object resolution.\r\n     *\r\n     * Because we never set this we have to track it in separately from the `schema` so\r\n     * we know when we have to specify the full schema or not.\r\n     *\r\n     * In most cases this will be `public`.\r\n     */\r\n    searchSchema?: string;\r\n\r\n    /**\r\n     * Indicates if replication is enabled.\r\n     */\r\n    isReplicated: boolean = false;\r\n\r\n    /**\r\n     * Indicates if tree tables are supported by this driver.\r\n     */\r\n    treeSupport = true;\r\n\r\n    /**\r\n     * Represent transaction support by this driver\r\n     */\r\n    transactionSupport = \"nested\" as const;\r\n\r\n    /**\r\n     * Gets list of supported column data types by a driver.\r\n     *\r\n     * @see https://www.tutorialspoint.com/postgresql/postgresql_data_types.htm\r\n     * @see https://www.postgresql.org/docs/9.2/static/datatype.html\r\n     */\r\n    supportedDataTypes: ColumnType[] = [\r\n        \"int\",\r\n        \"int2\",\r\n        \"int4\",\r\n        \"int8\",\r\n        \"smallint\",\r\n        \"integer\",\r\n        \"bigint\",\r\n        \"decimal\",\r\n        \"numeric\",\r\n        \"real\",\r\n        \"float\",\r\n        \"float4\",\r\n        \"float8\",\r\n        \"double precision\",\r\n        \"money\",\r\n        \"character varying\",\r\n        \"varchar\",\r\n        \"character\",\r\n        \"char\",\r\n        \"text\",\r\n        \"citext\",\r\n        \"hstore\",\r\n        \"bytea\",\r\n        \"bit\",\r\n        \"varbit\",\r\n        \"bit varying\",\r\n        \"timetz\",\r\n        \"timestamptz\",\r\n        \"timestamp\",\r\n        \"timestamp without time zone\",\r\n        \"timestamp with time zone\",\r\n        \"date\",\r\n        \"time\",\r\n        \"time without time zone\",\r\n        \"time with time zone\",\r\n        \"interval\",\r\n        \"bool\",\r\n        \"boolean\",\r\n        \"enum\",\r\n        \"point\",\r\n        \"line\",\r\n        \"lseg\",\r\n        \"box\",\r\n        \"path\",\r\n        \"polygon\",\r\n        \"circle\",\r\n        \"cidr\",\r\n        \"inet\",\r\n        \"macaddr\",\r\n        \"tsvector\",\r\n        \"tsquery\",\r\n        \"uuid\",\r\n        \"xml\",\r\n        \"json\",\r\n        \"jsonb\",\r\n        \"int4range\",\r\n        \"int8range\",\r\n        \"numrange\",\r\n        \"tsrange\",\r\n        \"tstzrange\",\r\n        \"daterange\",\r\n        \"geometry\",\r\n        \"geography\",\r\n        \"cube\",\r\n        \"ltree\"\r\n    ];\r\n\r\n    /**\r\n     * Returns type of upsert supported by driver if any\r\n     */\r\n    readonly supportedUpsertType = \"on-conflict-do-update\";\r\n\r\n    /**\r\n     * Gets list of spatial column data types.\r\n     */\r\n    spatialTypes: ColumnType[] = [\r\n        \"geometry\",\r\n        \"geography\"\r\n    ];\r\n\r\n    /**\r\n     * Gets list of column data types that support length by a driver.\r\n     */\r\n    withLengthColumnTypes: ColumnType[] = [\r\n        \"character varying\",\r\n        \"varchar\",\r\n        \"character\",\r\n        \"char\",\r\n        \"bit\",\r\n        \"varbit\",\r\n        \"bit varying\"\r\n    ];\r\n\r\n    /**\r\n     * Gets list of column data types that support precision by a driver.\r\n     */\r\n    withPrecisionColumnTypes: ColumnType[] = [\r\n        \"numeric\",\r\n        \"decimal\",\r\n        \"interval\",\r\n        \"time without time zone\",\r\n        \"time with time zone\",\r\n        \"timestamp without time zone\",\r\n        \"timestamp with time zone\"\r\n    ];\r\n\r\n    /**\r\n     * Gets list of column data types that support scale by a driver.\r\n     */\r\n    withScaleColumnTypes: ColumnType[] = [\r\n        \"numeric\",\r\n        \"decimal\"\r\n    ];\r\n\r\n    /**\r\n     * Orm has special columns and we need to know what database column types should be for those types.\r\n     * Column types are driver dependant.\r\n     */\r\n    mappedDataTypes: MappedColumnTypes = {\r\n        createDate: \"timestamp\",\r\n        createDateDefault: \"now()\",\r\n        updateDate: \"timestamp\",\r\n        updateDateDefault: \"now()\",\r\n        deleteDate: \"timestamp\",\r\n        deleteDateNullable: true,\r\n        version: \"int4\",\r\n        treeLevel: \"int4\",\r\n        migrationId: \"int4\",\r\n        migrationName: \"varchar\",\r\n        migrationTimestamp: \"int8\",\r\n        cacheId: \"int4\",\r\n        cacheIdentifier: \"varchar\",\r\n        cacheTime: \"int8\",\r\n        cacheDuration: \"int4\",\r\n        cacheQuery: \"text\",\r\n        cacheResult: \"text\",\r\n        metadataType: \"varchar\",\r\n        metadataDatabase: \"varchar\",\r\n        metadataSchema: \"varchar\",\r\n        metadataTable: \"varchar\",\r\n        metadataName: \"varchar\",\r\n        metadataValue: \"text\",\r\n    };\r\n\r\n    /**\r\n     * Default values of length, precision and scale depends on column data type.\r\n     * Used in the cases when length/precision/scale is not specified by user.\r\n     */\r\n    dataTypeDefaults: DataTypeDefaults = {\r\n        \"character\": { length: 1 },\r\n        \"bit\": { length: 1 },\r\n        \"interval\": { precision: 6 },\r\n        \"time without time zone\": { precision: 6 },\r\n        \"time with time zone\": { precision: 6 },\r\n        \"timestamp without time zone\": { precision: 6 },\r\n        \"timestamp with time zone\": { precision: 6 },\r\n    };\r\n\r\n    /**\r\n     * Max length allowed by Postgres for aliases.\r\n     * @see https://www.postgresql.org/docs/current/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS\r\n     */\r\n    maxAliasLength = 63;\r\n\r\n    isGeneratedColumnsSupported: boolean = false;\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Constructor\r\n    // -------------------------------------------------------------------------\r\n\r\n    constructor(connection?: Connection) {\r\n        if (!connection) {\r\n            return;\r\n        }\r\n\r\n        this.connection = connection;\r\n        this.options = connection.options as PostgresConnectionOptions;\r\n        this.isReplicated = this.options.replication ? true : false;\r\n        if(this.options.useUTC) {\r\n            process.env.PGTZ = \"UTC\";\r\n        }\r\n        // load postgres package\r\n        this.loadDependencies();\r\n\r\n        this.database = DriverUtils.buildDriverOptions(this.options.replication ? this.options.replication.master : this.options).database;\r\n        this.schema = DriverUtils.buildDriverOptions(this.options).schema;\r\n\r\n        // ObjectUtils.assign(this.options, DriverUtils.buildDriverOptions(connection.options)); // todo: do it better way\r\n        // validate options to make sure everything is set\r\n        // todo: revisit validation with replication in mind\r\n        // if (!this.options.host)\r\n        //     throw new DriverOptionNotSetError(\"host\");\r\n        // if (!this.options.username)\r\n        //     throw new DriverOptionNotSetError(\"username\");\r\n        // if (!this.options.database)\r\n        //     throw new DriverOptionNotSetError(\"database\");\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Implemented Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Performs connection to the database.\r\n     * Based on pooling options, it can either create connection immediately,\r\n     * either create a pool and create connection when needed.\r\n     */\r\n    async connect(): Promise<void> {\r\n\r\n        if (this.options.replication) {\r\n            this.slaves = await Promise.all(this.options.replication.slaves.map(slave => {\r\n                return this.createPool(this.options, slave);\r\n            }));\r\n            this.master = await this.createPool(this.options, this.options.replication.master);\r\n        } else {\r\n            this.master = await this.createPool(this.options, this.options);\r\n        }\r\n\r\n        if (!this.database || !this.searchSchema) {\r\n            const queryRunner = await this.createQueryRunner(\"master\");\r\n\r\n            if (!this.database) {\r\n                this.database = await queryRunner.getCurrentDatabase();\r\n            }\r\n\r\n            if (!this.searchSchema) {\r\n                this.searchSchema = await queryRunner.getCurrentSchema();\r\n            }\r\n\r\n            await queryRunner.release();\r\n        }\r\n\r\n        if (!this.schema) {\r\n            this.schema = this.searchSchema;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Makes any action after connection (e.g. create extensions in Postgres driver).\r\n     */\r\n    async afterConnect(): Promise<void> {\r\n        const extensionsMetadata = await this.checkMetadataForExtensions();\r\n        const [ connection, release ] = await this.obtainMasterConnection()\r\n\r\n        const installExtensions = this.options.installExtensions === undefined || this.options.installExtensions;\r\n        if (installExtensions && extensionsMetadata.hasExtensions) {\r\n            await this.enableExtensions(extensionsMetadata, connection);\r\n        }\r\n\r\n        const results = await this.executeQuery(connection, \"SHOW server_version;\") as {\r\n            rows: {\r\n                server_version: string;\r\n            }[];\r\n        };\r\n        const versionString = results.rows[0].server_version;\r\n        this.isGeneratedColumnsSupported = VersionUtils.isGreaterOrEqual(versionString, \"12.0\");\r\n\r\n        await release()\r\n    }\r\n\r\n    protected async enableExtensions(extensionsMetadata: any, connection: any) {\r\n        const { logger } = this.connection;\r\n\r\n        const {\r\n            hasUuidColumns,\r\n            hasCitextColumns,\r\n            hasHstoreColumns,\r\n            hasCubeColumns,\r\n            hasGeometryColumns,\r\n            hasLtreeColumns,\r\n            hasExclusionConstraints,\r\n        } = extensionsMetadata;\r\n\r\n        if (hasUuidColumns)\r\n            try {\r\n                await this.executeQuery(connection, `CREATE EXTENSION IF NOT EXISTS \"${this.options.uuidExtension || \"uuid-ossp\"}\"`);\r\n            } catch (_) {\r\n                logger.log(\"warn\", `At least one of the entities has uuid column, but the '${this.options.uuidExtension || \"uuid-ossp\"}' extension cannot be installed automatically. Please install it manually using superuser rights, or select another uuid extension.`);\r\n            }\r\n        if (hasCitextColumns)\r\n            try {\r\n                await this.executeQuery(connection, `CREATE EXTENSION IF NOT EXISTS \"citext\"`);\r\n            } catch (_) {\r\n                logger.log(\"warn\", \"At least one of the entities has citext column, but the 'citext' extension cannot be installed automatically. Please install it manually using superuser rights\");\r\n            }\r\n        if (hasHstoreColumns)\r\n            try {\r\n                await this.executeQuery(connection, `CREATE EXTENSION IF NOT EXISTS \"hstore\"`);\r\n            } catch (_) {\r\n                logger.log(\"warn\", \"At least one of the entities has hstore column, but the 'hstore' extension cannot be installed automatically. Please install it manually using superuser rights\");\r\n            }\r\n        if (hasGeometryColumns)\r\n            try {\r\n                await this.executeQuery(connection, `CREATE EXTENSION IF NOT EXISTS \"postgis\"`);\r\n            } catch (_) {\r\n                logger.log(\"warn\", \"At least one of the entities has a geometry column, but the 'postgis' extension cannot be installed automatically. Please install it manually using superuser rights\");\r\n            }\r\n        if (hasCubeColumns)\r\n            try {\r\n                await this.executeQuery(connection, `CREATE EXTENSION IF NOT EXISTS \"cube\"`);\r\n            } catch (_) {\r\n                logger.log(\"warn\", \"At least one of the entities has a cube column, but the 'cube' extension cannot be installed automatically. Please install it manually using superuser rights\");\r\n            }\r\n        if (hasLtreeColumns)\r\n            try {\r\n                await this.executeQuery(connection, `CREATE EXTENSION IF NOT EXISTS \"ltree\"`);\r\n            } catch (_) {\r\n                logger.log(\"warn\", \"At least one of the entities has a cube column, but the 'ltree' extension cannot be installed automatically. Please install it manually using superuser rights\");\r\n            }\r\n        if (hasExclusionConstraints)\r\n            try {\r\n                // The btree_gist extension provides operator support in PostgreSQL exclusion constraints\r\n                await this.executeQuery(connection, `CREATE EXTENSION IF NOT EXISTS \"btree_gist\"`);\r\n            } catch (_) {\r\n                logger.log(\"warn\", \"At least one of the entities has an exclusion constraint, but the 'btree_gist' extension cannot be installed automatically. Please install it manually using superuser rights\");\r\n            }\r\n    }\r\n\r\n    protected async checkMetadataForExtensions() {\r\n        const hasUuidColumns = this.connection.entityMetadatas.some(metadata => {\r\n            return metadata.generatedColumns.filter(column => column.generationStrategy === \"uuid\").length > 0;\r\n        });\r\n        const hasCitextColumns = this.connection.entityMetadatas.some(metadata => {\r\n            return metadata.columns.filter(column => column.type === \"citext\").length > 0;\r\n        });\r\n        const hasHstoreColumns = this.connection.entityMetadatas.some(metadata => {\r\n            return metadata.columns.filter(column => column.type === \"hstore\").length > 0;\r\n        });\r\n        const hasCubeColumns = this.connection.entityMetadatas.some(metadata => {\r\n            return metadata.columns.filter(column => column.type === \"cube\").length > 0;\r\n        });\r\n        const hasGeometryColumns = this.connection.entityMetadatas.some(metadata => {\r\n            return metadata.columns.filter(column => this.spatialTypes.indexOf(column.type) >= 0).length > 0;\r\n        });\r\n        const hasLtreeColumns = this.connection.entityMetadatas.some(metadata => {\r\n            return metadata.columns.filter(column => column.type === \"ltree\").length > 0;\r\n        });\r\n        const hasExclusionConstraints = this.connection.entityMetadatas.some(metadata => {\r\n            return metadata.exclusions.length > 0;\r\n        });\r\n\r\n        return {\r\n            hasUuidColumns,\r\n            hasCitextColumns,\r\n            hasHstoreColumns,\r\n            hasCubeColumns,\r\n            hasGeometryColumns,\r\n            hasLtreeColumns,\r\n            hasExclusionConstraints,\r\n            hasExtensions: hasUuidColumns || hasCitextColumns || hasHstoreColumns || hasGeometryColumns || hasCubeColumns || hasLtreeColumns || hasExclusionConstraints,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Closes connection with database.\r\n     */\r\n    async disconnect(): Promise<void> {\r\n        if (!this.master)\r\n            return Promise.reject(new ConnectionIsNotSetError(\"postgres\"));\r\n\r\n        await this.closePool(this.master);\r\n        await Promise.all(this.slaves.map(slave => this.closePool(slave)));\r\n        this.master = undefined;\r\n        this.slaves = [];\r\n    }\r\n\r\n    /**\r\n     * Creates a schema builder used to build and sync a schema.\r\n     */\r\n    createSchemaBuilder() {\r\n        return new RdbmsSchemaBuilder(this.connection);\r\n    }\r\n\r\n    /**\r\n     * Creates a query runner used to execute database queries.\r\n     */\r\n    createQueryRunner(mode: ReplicationMode): QueryRunner {\r\n        return new PostgresQueryRunner(this, mode);\r\n    }\r\n\r\n    /**\r\n     * Prepares given value to a value to be persisted, based on its column type and metadata.\r\n     */\r\n    preparePersistentValue(value: any, columnMetadata: ColumnMetadata): any {\r\n        if (columnMetadata.transformer)\r\n            value = ApplyValueTransformers.transformTo(columnMetadata.transformer, value);\r\n\r\n        if (value === null || value === undefined)\r\n            return value;\r\n\r\n        if (columnMetadata.type === Boolean) {\r\n            return value === true ? 1 : 0;\r\n\r\n        } else if (columnMetadata.type === \"date\") {\r\n            return DateUtils.mixedDateToDateString(value);\r\n\r\n        } else if (columnMetadata.type === \"time\") {\r\n            return DateUtils.mixedDateToTimeString(value);\r\n\r\n        } else if (columnMetadata.type === \"datetime\"\r\n            || columnMetadata.type === Date\r\n            || columnMetadata.type === \"timestamp\"\r\n            || columnMetadata.type === \"timestamp with time zone\"\r\n            || columnMetadata.type === \"timestamp without time zone\") {\r\n            return DateUtils.mixedDateToDate(value);\r\n\r\n        } else if ([\"json\", \"jsonb\", ...this.spatialTypes].indexOf(columnMetadata.type) >= 0) {\r\n            return JSON.stringify(value);\r\n\r\n        } else if (columnMetadata.type === \"hstore\") {\r\n            if (typeof value === \"string\") {\r\n                return value;\r\n            } else {\r\n                // https://www.postgresql.org/docs/9.0/hstore.html\r\n                const quoteString = (value: unknown) => {\r\n                    // If a string to be quoted is `null` or `undefined`, we return a literal unquoted NULL.\r\n                    // This way, NULL values can be stored in the hstore object.\r\n                    if (value === null || typeof value === \"undefined\") {\r\n                        return \"NULL\";\r\n                    }\r\n                    // Convert non-null values to string since HStore only stores strings anyway.\r\n                    // To include a double quote or a backslash in a key or value, escape it with a backslash.\r\n                    return `\"${`${value}`.replace(/(?=[\"\\\\])/g, \"\\\\\")}\"`;\r\n                };\r\n                return Object.keys(value).map(key => quoteString(key) + \"=>\" + quoteString(value[key])).join(\",\");\r\n            }\r\n\r\n        } else if (columnMetadata.type === \"simple-array\") {\r\n            return DateUtils.simpleArrayToString(value);\r\n\r\n        } else if (columnMetadata.type === \"simple-json\") {\r\n            return DateUtils.simpleJsonToString(value);\r\n\r\n        } else if (columnMetadata.type === \"cube\") {\r\n            if (columnMetadata.isArray) {\r\n                return `{${value.map((cube: number[]) => `\"(${cube.join(\",\")})\"`).join(\",\")}}`;\r\n            }\r\n            return `(${value.join(\",\")})`;\r\n\r\n        } else if (columnMetadata.type === \"ltree\") {\r\n            return value.split(\".\").filter(Boolean).join(\".\").replace(/[\\s]+/g, \"_\");\r\n        } else if (\r\n            (\r\n                columnMetadata.type === \"enum\"\r\n                || columnMetadata.type === \"simple-enum\"\r\n            )\r\n            && !columnMetadata.isArray\r\n        ) {\r\n            return \"\" + value;\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * Prepares given value to a value to be persisted, based on its column type or metadata.\r\n     */\r\n    prepareHydratedValue(value: any, columnMetadata: ColumnMetadata): any {\r\n        if (value === null || value === undefined)\r\n            return columnMetadata.transformer ? ApplyValueTransformers.transformFrom(columnMetadata.transformer, value) : value;\r\n\r\n        if (columnMetadata.type === Boolean) {\r\n            value = value ? true : false;\r\n\r\n        } else if (columnMetadata.type === \"datetime\"\r\n            || columnMetadata.type === Date\r\n            || columnMetadata.type === \"timestamp\"\r\n            || columnMetadata.type === \"timestamp with time zone\"\r\n            || columnMetadata.type === \"timestamp without time zone\") {\r\n            value = DateUtils.normalizeHydratedDate(value);\r\n\r\n        } else if (columnMetadata.type === \"date\") {\r\n            value = DateUtils.mixedDateToDateString(value);\r\n\r\n        } else if (columnMetadata.type === \"time\") {\r\n            value = DateUtils.mixedTimeToString(value);\r\n\r\n        } else if (columnMetadata.type === \"hstore\") {\r\n            if (columnMetadata.hstoreType === \"object\") {\r\n                const unescapeString = (str: string) => str.replace(/\\\\./g, (m) => m[1]);\r\n                const regexp = /\"([^\"\\\\]*(?:\\\\.[^\"\\\\]*)*)\"=>(?:(NULL)|\"([^\"\\\\]*(?:\\\\.[^\"\\\\]*)*)\")(?:,|$)/g;\r\n                const object: ObjectLiteral = {};\r\n                `${value}`.replace(regexp, (_, key, nullValue, stringValue) => {\r\n                    object[unescapeString(key)] = nullValue ? null : unescapeString(stringValue);\r\n                    return \"\";\r\n                });\r\n                return object;\r\n\r\n            } else {\r\n                return value;\r\n            }\r\n\r\n        } else if (columnMetadata.type === \"simple-array\") {\r\n            value = DateUtils.stringToSimpleArray(value);\r\n\r\n        } else if (columnMetadata.type === \"simple-json\") {\r\n            value = DateUtils.stringToSimpleJson(value);\r\n\r\n        } else if (columnMetadata.type === \"cube\") {\r\n            value = value.replace(/[\\(\\)\\s]+/g, \"\"); // remove whitespace\r\n            if (columnMetadata.isArray) {\r\n                /**\r\n                 * Strips these groups from `{\"1,2,3\",\"\",NULL}`:\r\n                 * 1. [\"1,2,3\", undefined]  <- cube of arity 3\r\n                 * 2. [\"\", undefined]         <- cube of arity 0\r\n                 * 3. [undefined, \"NULL\"]     <- NULL\r\n                 */\r\n                const regexp = /(?:\\\"((?:[\\d\\s\\.,])*)\\\")|(?:(NULL))/g;\r\n                const unparsedArrayString = value;\r\n\r\n                value = [];\r\n                let cube: RegExpExecArray | null = null;\r\n                // Iterate through all regexp matches for cubes/null in array\r\n                while ((cube = regexp.exec(unparsedArrayString)) !== null) {\r\n                    if (cube[1] !== undefined) {\r\n                        value.push(cube[1].split(\",\").filter(Boolean).map(Number));\r\n                    } else {\r\n                        value.push(undefined);\r\n                    }\r\n                }\r\n            } else {\r\n                value = value.split(\",\").filter(Boolean).map(Number);\r\n            }\r\n\r\n        } else if (columnMetadata.type === \"enum\" || columnMetadata.type === \"simple-enum\" ) {\r\n            if (columnMetadata.isArray) {\r\n                if (value === \"{}\") return [];\r\n\r\n                // manually convert enum array to array of values (pg does not support, see https://github.com/brianc/node-pg-types/issues/56)\r\n                value = (value as string).substr(1, (value as string).length - 2).split(\",\").map(val => {\r\n                    // replace double quotes from the beginning and from the end\r\n                    if (val.startsWith(`\"`) && val.endsWith(`\"`)) val = val.slice(1, -1);\r\n                    // replace double escaped backslash to single escaped e.g. \\\\\\\\ -> \\\\\r\n                    val = val.replace(/(\\\\\\\\)/g, \"\\\\\");\r\n                    // replace escaped double quotes to non-escaped e.g. \\\"asd\\\" -> \"asd\"\r\n                    return val.replace(/(\\\\\")/g, '\"');\r\n                });\r\n\r\n                // convert to number if that exists in possible enum options\r\n                value = value.map((val: string) => {\r\n                    return !isNaN(+val) && columnMetadata.enum!.indexOf(parseInt(val)) >= 0 ? parseInt(val) : val;\r\n                });\r\n            } else {\r\n                // convert to number if that exists in possible enum options\r\n                value = !isNaN(+value) && columnMetadata.enum!.indexOf(parseInt(value)) >= 0 ? parseInt(value) : value;\r\n            }\r\n        }\r\n\r\n        if (columnMetadata.transformer)\r\n            value = ApplyValueTransformers.transformFrom(columnMetadata.transformer, value);\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * Replaces parameters in the given sql with special escaping character\r\n     * and an array of parameter names to be passed to a query.\r\n     */\r\n    escapeQueryWithParameters(sql: string, parameters: ObjectLiteral, nativeParameters: ObjectLiteral): [string, any[]] {\r\n        const escapedParameters: any[] = Object.keys(nativeParameters).map(key => nativeParameters[key]);\r\n        if (!parameters || !Object.keys(parameters).length)\r\n            return [sql, escapedParameters];\r\n\r\n        sql = sql.replace(/:(\\.\\.\\.)?([A-Za-z0-9_.]+)/g, (full, isArray: string, key: string): string => {\r\n            if (!parameters.hasOwnProperty(key)) {\r\n                return full;\r\n            }\r\n\r\n            let value: any = parameters[key];\r\n\r\n            if (isArray) {\r\n                return value.map((v: any) => {\r\n                    escapedParameters.push(v);\r\n                    return this.createParameter(key, escapedParameters.length - 1);\r\n                }).join(\", \");\r\n\r\n            }\r\n\r\n            if (value instanceof Function) {\r\n                return value();\r\n            }\r\n\r\n            escapedParameters.push(value);\r\n            return this.createParameter(key, escapedParameters.length - 1);\r\n        }); // todo: make replace only in value statements, otherwise problems\r\n        return [sql, escapedParameters];\r\n    }\r\n\r\n    /**\r\n     * Escapes a column name.\r\n     */\r\n    escape(columnName: string): string {\r\n        return \"\\\"\" + columnName + \"\\\"\";\r\n    }\r\n\r\n    /**\r\n     * Build full table name with schema name and table name.\r\n     * E.g. myDB.mySchema.myTable\r\n     */\r\n    buildTableName(tableName: string, schema?: string): string {\r\n        let tablePath = [ tableName ];\r\n\r\n        if (schema) {\r\n            tablePath.unshift(schema);\r\n        }\r\n\r\n        return tablePath.join(\".\");\r\n    }\r\n\r\n    /**\r\n     * Parse a target table name or other types and return a normalized table definition.\r\n     */\r\n    parseTableName(target: EntityMetadata | Table | View | TableForeignKey | string): { database?: string, schema?: string, tableName: string } {\r\n        const driverDatabase = this.database;\r\n        const driverSchema = this.schema;\r\n\r\n        if (target instanceof Table || target instanceof View) {\r\n            const parsed = this.parseTableName(target.name);\r\n\r\n            return {\r\n                database: target.database || parsed.database || driverDatabase,\r\n                schema: target.schema || parsed.schema || driverSchema,\r\n                tableName: parsed.tableName\r\n            };\r\n        }\r\n\r\n        if (target instanceof TableForeignKey) {\r\n            const parsed = this.parseTableName(target.referencedTableName);\r\n\r\n            return {\r\n                database: target.referencedDatabase || parsed.database || driverDatabase,\r\n                schema: target.referencedSchema || parsed.schema || driverSchema,\r\n                tableName: parsed.tableName\r\n            };\r\n        }\r\n\r\n        if (target instanceof EntityMetadata) {\r\n            // EntityMetadata tableName is never a path\r\n\r\n            return {\r\n                database: target.database || driverDatabase,\r\n                schema: target.schema || driverSchema,\r\n                tableName: target.tableName\r\n            };\r\n\r\n        }\r\n\r\n        const parts = target.split(\".\");\r\n\r\n        return {\r\n            database: driverDatabase,\r\n            schema: (parts.length > 1 ? parts[0] : undefined) || driverSchema,\r\n            tableName: parts.length > 1 ? parts[1] : parts[0],\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Creates a database type from a given column metadata.\r\n     */\r\n    normalizeType(column: { type?: ColumnType, length?: number | string, precision?: number|null, scale?: number, isArray?: boolean }): string {\r\n        if (column.type === Number || column.type === \"int\" || column.type === \"int4\") {\r\n            return \"integer\";\r\n\r\n        } else if (column.type === String || column.type === \"varchar\") {\r\n            return \"character varying\";\r\n\r\n        } else if (column.type === Date || column.type === \"timestamp\") {\r\n            return \"timestamp without time zone\";\r\n\r\n        } else if (column.type === \"timestamptz\") {\r\n            return \"timestamp with time zone\";\r\n\r\n        } else if (column.type === \"time\") {\r\n            return \"time without time zone\";\r\n\r\n        } else if (column.type === \"timetz\") {\r\n            return \"time with time zone\";\r\n\r\n        } else if (column.type === Boolean || column.type === \"bool\") {\r\n            return \"boolean\";\r\n\r\n        } else if (column.type === \"simple-array\") {\r\n            return \"text\";\r\n\r\n        } else if (column.type === \"simple-json\") {\r\n            return \"text\";\r\n\r\n        } else if (column.type === \"simple-enum\") {\r\n            return \"enum\";\r\n\r\n        } else if (column.type === \"int2\") {\r\n            return \"smallint\";\r\n\r\n        } else if (column.type === \"int8\") {\r\n            return \"bigint\";\r\n\r\n        } else if (column.type === \"decimal\") {\r\n            return \"numeric\";\r\n\r\n        } else if (column.type === \"float8\" || column.type === \"float\") {\r\n            return \"double precision\";\r\n\r\n        } else if (column.type === \"float4\") {\r\n            return \"real\";\r\n\r\n        } else if (column.type === \"char\") {\r\n            return \"character\";\r\n\r\n        } else if (column.type === \"varbit\") {\r\n            return \"bit varying\";\r\n\r\n        } else {\r\n            return column.type as string || \"\";\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Normalizes \"default\" value of the column.\r\n     */\r\n    normalizeDefault(columnMetadata: ColumnMetadata): string | undefined {\r\n        const defaultValue = columnMetadata.default;\r\n\r\n        if (defaultValue === null) {\r\n            return undefined;\r\n        }\r\n\r\n        if (columnMetadata.isArray && Array.isArray(defaultValue)) {\r\n            return `'{${defaultValue.map((val: string) => `${val}`).join(\",\")}}'`;\r\n        }\r\n\r\n        if (\r\n            (columnMetadata.type === \"enum\"\r\n            || columnMetadata.type === \"simple-enum\"\r\n            || typeof defaultValue === \"number\"\r\n            || typeof defaultValue === \"string\")\r\n            && defaultValue !== undefined\r\n        ) {\r\n            return `'${defaultValue}'`;\r\n        }\r\n\r\n        if (typeof defaultValue === \"boolean\") {\r\n            return defaultValue ? \"true\" : \"false\";\r\n        }\r\n\r\n        if (typeof defaultValue === \"function\") {\r\n            const value = defaultValue();\r\n\r\n            return this.normalizeDatetimeFunction(value);\r\n        }\r\n\r\n        if (typeof defaultValue === \"object\") {\r\n            return `'${JSON.stringify(defaultValue)}'`;\r\n        }\r\n\r\n        if (defaultValue === undefined) {\r\n            return undefined;\r\n        }\r\n\r\n        return `${defaultValue}`;\r\n    }\r\n\r\n    /**\r\n     * Compares \"default\" value of the column.\r\n     * Postgres sorts json values before it is saved, so in that case a deep comparison has to be performed to see if has changed.\r\n     */\r\n    private defaultEqual(columnMetadata: ColumnMetadata, tableColumn: TableColumn): boolean {\r\n        if (\r\n            [\"json\", \"jsonb\"].includes(columnMetadata.type as string)\r\n            && ![\"function\", \"undefined\"].includes(typeof columnMetadata.default)\r\n        ) {\r\n            const tableColumnDefault = typeof tableColumn.default === \"string\" ?\r\n                JSON.parse(tableColumn.default.substring(1, tableColumn.default.length-1)) :\r\n                tableColumn.default;\r\n\r\n            return OrmUtils.deepCompare(columnMetadata.default, tableColumnDefault);\r\n        }\r\n\r\n        const columnDefault = this.lowerDefaultValueIfNecessary(this.normalizeDefault(columnMetadata));\r\n        return columnDefault === tableColumn.default;\r\n    }\r\n\r\n    /**\r\n     * Normalizes \"isUnique\" value of the column.\r\n     */\r\n    normalizeIsUnique(column: ColumnMetadata): boolean {\r\n        return column.entityMetadata.uniques.some(uq => uq.columns.length === 1 && uq.columns[0] === column);\r\n    }\r\n\r\n    /**\r\n     * Returns default column lengths, which is required on column creation.\r\n     */\r\n    getColumnLength(column: ColumnMetadata): string {\r\n        return column.length ? column.length.toString() : \"\";\r\n    }\r\n\r\n    /**\r\n     * Creates column type definition including length, precision and scale\r\n     */\r\n    createFullType(column: TableColumn): string {\r\n        let type = column.type;\r\n\r\n        if (column.length) {\r\n            type += \"(\" + column.length + \")\";\r\n        } else if (column.precision !== null && column.precision !== undefined && column.scale !== null && column.scale !== undefined) {\r\n            type += \"(\" + column.precision + \",\" + column.scale + \")\";\r\n        } else if (column.precision !== null && column.precision !== undefined) {\r\n            type +=  \"(\" + column.precision + \")\";\r\n        }\r\n\r\n        if (column.type === \"time without time zone\") {\r\n            type = \"TIME\" + (column.precision !== null && column.precision !== undefined ? \"(\" + column.precision + \")\" : \"\");\r\n\r\n        } else if (column.type === \"time with time zone\") {\r\n            type = \"TIME\" + (column.precision !== null && column.precision !== undefined ? \"(\" + column.precision + \")\" : \"\") + \" WITH TIME ZONE\";\r\n\r\n        } else if (column.type === \"timestamp without time zone\") {\r\n            type = \"TIMESTAMP\" + (column.precision !== null && column.precision !== undefined ? \"(\" + column.precision + \")\" : \"\");\r\n\r\n        } else if (column.type === \"timestamp with time zone\") {\r\n            type = \"TIMESTAMP\" + (column.precision !== null && column.precision !== undefined ? \"(\" + column.precision + \")\" : \"\") + \" WITH TIME ZONE\";\r\n        } else if (this.spatialTypes.indexOf(column.type as ColumnType) >= 0) {\r\n            if (column.spatialFeatureType != null && column.srid != null) {\r\n                type = `${column.type}(${column.spatialFeatureType},${column.srid})`;\r\n            } else if (column.spatialFeatureType != null) {\r\n                type = `${column.type}(${column.spatialFeatureType})`;\r\n            } else {\r\n                type = column.type;\r\n            }\r\n        }\r\n\r\n        if (column.isArray)\r\n            type += \" array\";\r\n\r\n        return type;\r\n    }\r\n\r\n    /**\r\n     * Obtains a new database connection to a master server.\r\n     * Used for replication.\r\n     * If replication is not setup then returns default connection's database connection.\r\n     */\r\n    async obtainMasterConnection(): Promise<[any, Function]> {\r\n        if (!this.master) {\r\n            throw new TypeORMError(\"Driver not Connected\");\r\n        }\r\n\r\n        return new Promise((ok, fail) => {\r\n            this.master.connect((err: any, connection: any, release: any) => {\r\n                err ? fail(err) : ok([connection, release]);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Obtains a new database connection to a slave server.\r\n     * Used for replication.\r\n     * If replication is not setup then returns master (default) connection's database connection.\r\n     */\r\n    async obtainSlaveConnection(): Promise<[any, Function]> {\r\n        if (!this.slaves.length) {\r\n            return this.obtainMasterConnection();\r\n        }\r\n\r\n        const random = Math.floor(Math.random() * this.slaves.length);\r\n\r\n        return new Promise((ok, fail) => {\r\n            this.slaves[random].connect((err: any, connection: any, release: any) => {\r\n                err ? fail(err) : ok([connection, release]);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Creates generated map of values generated or returned by database after INSERT query.\r\n     *\r\n     * todo: slow. optimize Object.keys(), OrmUtils.mergeDeep and column.createValueMap parts\r\n     */\r\n    createGeneratedMap(metadata: EntityMetadata, insertResult: ObjectLiteral) {\r\n        if (!insertResult)\r\n            return undefined;\r\n\r\n        return Object.keys(insertResult).reduce((map, key) => {\r\n            const column = metadata.findColumnWithDatabaseName(key);\r\n            if (column) {\r\n                OrmUtils.mergeDeep(map, column.createValueMap(insertResult[key]));\r\n                // OrmUtils.mergeDeep(map, column.createValueMap(this.prepareHydratedValue(insertResult[key], column))); // TODO: probably should be like there, but fails on enums, fix later\r\n            }\r\n            return map;\r\n        }, {} as ObjectLiteral);\r\n    }\r\n\r\n    /**\r\n     * Differentiate columns of this table and columns from the given column metadatas columns\r\n     * and returns only changed.\r\n     */\r\n    findChangedColumns(tableColumns: TableColumn[], columnMetadatas: ColumnMetadata[]): ColumnMetadata[] {\r\n        return columnMetadatas.filter(columnMetadata => {\r\n            const tableColumn = tableColumns.find(c => c.name === columnMetadata.databaseName);\r\n            if (!tableColumn)\r\n                return false; // we don't need new columns, we only need exist and changed\r\n\r\n            const isColumnChanged = tableColumn.name !== columnMetadata.databaseName\r\n                || tableColumn.type !== this.normalizeType(columnMetadata)\r\n                || tableColumn.length !== columnMetadata.length\r\n                || tableColumn.isArray !== columnMetadata.isArray\r\n                || tableColumn.precision !== columnMetadata.precision\r\n                || (columnMetadata.scale !== undefined && tableColumn.scale !== columnMetadata.scale)\r\n                || tableColumn.comment !== this.escapeComment(columnMetadata.comment)\r\n                || (!tableColumn.isGenerated && !this.defaultEqual(columnMetadata, tableColumn)) // we included check for generated here, because generated columns already can have default values\r\n                || tableColumn.isPrimary !== columnMetadata.isPrimary\r\n                || tableColumn.isNullable !== columnMetadata.isNullable\r\n                || tableColumn.isUnique !== this.normalizeIsUnique(columnMetadata)\r\n                || tableColumn.enumName !== columnMetadata.enumName\r\n                || (tableColumn.enum && columnMetadata.enum && !OrmUtils.isArraysEqual(tableColumn.enum, columnMetadata.enum.map(val => val + \"\"))) // enums in postgres are always strings\r\n                || tableColumn.isGenerated !== columnMetadata.isGenerated\r\n                || (tableColumn.spatialFeatureType || \"\").toLowerCase() !== (columnMetadata.spatialFeatureType || \"\").toLowerCase()\r\n                || tableColumn.srid !== columnMetadata.srid\r\n                || tableColumn.generatedType !== columnMetadata.generatedType\r\n                || (tableColumn.asExpression || \"\").trim() !== (columnMetadata.asExpression || \"\").trim();\r\n\r\n            // DEBUG SECTION\r\n            // if (isColumnChanged) {\r\n            //     console.log(\"table:\", columnMetadata.entityMetadata.tableName);\r\n            //     console.log(\"name:\", tableColumn.name, columnMetadata.databaseName);\r\n            //     console.log(\"type:\", tableColumn.type, this.normalizeType(columnMetadata));\r\n            //     console.log(\"length:\", tableColumn.length, columnMetadata.length);\r\n            //     console.log(\"isArray:\", tableColumn.isArray, columnMetadata.isArray);\r\n            //     console.log(\"precision:\", tableColumn.precision, columnMetadata.precision);\r\n            //     console.log(\"scale:\", tableColumn.scale, columnMetadata.scale);\r\n            //     console.log(\"comment:\", tableColumn.comment, this.escapeComment(columnMetadata.comment));\r\n            //     console.log(\"enumName:\", tableColumn.enumName, columnMetadata.enumName);\r\n            //     console.log(\"enum:\", tableColumn.enum && columnMetadata.enum && !OrmUtils.isArraysEqual(tableColumn.enum, columnMetadata.enum.map(val => val + \"\")));\r\n            //     console.log(\"isPrimary:\", tableColumn.isPrimary, columnMetadata.isPrimary);\r\n            //     console.log(\"isNullable:\", tableColumn.isNullable, columnMetadata.isNullable);\r\n            //     console.log(\"isUnique:\", tableColumn.isUnique, this.normalizeIsUnique(columnMetadata));\r\n            //     console.log(\"isGenerated:\", tableColumn.isGenerated, columnMetadata.isGenerated);\r\n            //     console.log(\"isGenerated 2:\", !tableColumn.isGenerated && this.lowerDefaultValueIfNecessary(this.normalizeDefault(columnMetadata)) !== tableColumn.default);\r\n            //     console.log(\"spatialFeatureType:\", (tableColumn.spatialFeatureType || \"\").toLowerCase(), (columnMetadata.spatialFeatureType || \"\").toLowerCase());\r\n            //     console.log(\"srid\", tableColumn.srid, columnMetadata.srid);\r\n            //     console.log(\"==========================================\");\r\n            // }\r\n\r\n            return isColumnChanged;\r\n        });\r\n    }\r\n\r\n    private lowerDefaultValueIfNecessary(value: string | undefined) {\r\n        // Postgres saves function calls in default value as lowercase #2733\r\n        if (!value) {\r\n            return value;\r\n        }\r\n        return value.split(`'`).map((v, i) => {\r\n            return i % 2 === 1 ? v : v.toLowerCase();\r\n        }).join(`'`);\r\n    }\r\n\r\n    /**\r\n     * Returns true if driver supports RETURNING / OUTPUT statement.\r\n     */\r\n    isReturningSqlSupported(): boolean {\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Returns true if driver supports uuid values generation on its own.\r\n     */\r\n    isUUIDGenerationSupported(): boolean {\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Returns true if driver supports fulltext indices.\r\n     */\r\n    isFullTextColumnTypeSupported(): boolean {\r\n        return false;\r\n    }\r\n\r\n    get uuidGenerator(): string {\r\n        return this.options.uuidExtension === \"pgcrypto\" ? \"gen_random_uuid()\" : \"uuid_generate_v4()\";\r\n    }\r\n\r\n    /**\r\n     * Creates an escaped parameter.\r\n     */\r\n    createParameter(parameterName: string, index: number): string {\r\n        return \"$\" + (index + 1);\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Public Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Loads postgres query stream package.\r\n     */\r\n    loadStreamDependency() {\r\n        try {\r\n            return PlatformTools.load(\"pg-query-stream\");\r\n\r\n        } catch (e) { // todo: better error for browser env\r\n            throw new TypeORMError(`To use streams you should install pg-query-stream package. Please run npm i pg-query-stream --save command.`);\r\n        }\r\n    }\r\n\r\n    // -------------------------------------------------------------------------\r\n    // Protected Methods\r\n    // -------------------------------------------------------------------------\r\n\r\n    /**\r\n     * If driver dependency is not given explicitly, then try to load it via \"require\".\r\n     */\r\n    protected loadDependencies(): void {\r\n        try {\r\n            const postgres = this.options.driver || PlatformTools.load(\"pg\");\r\n            this.postgres = postgres;\r\n            try {\r\n                const pgNative = this.options.nativeDriver || PlatformTools.load(\"pg-native\");\r\n                if (pgNative && this.postgres.native) this.postgres = this.postgres.native;\r\n\r\n            } catch (e) { }\r\n\r\n        } catch (e) { // todo: better error for browser env\r\n            throw new DriverPackageNotInstalledError(\"Postgres\", \"pg\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a new connection pool for a given database credentials.\r\n     */\r\n    protected async createPool(options: PostgresConnectionOptions, credentials: PostgresConnectionCredentialsOptions): Promise<any> {\r\n\r\n        credentials = Object.assign({}, credentials);\r\n\r\n        // build connection options for the driver\r\n        // See: https://github.com/brianc/node-postgres/tree/master/packages/pg-pool#create\r\n        const connectionOptions = Object.assign({}, {\r\n            connectionString: credentials.url,\r\n            host: credentials.host,\r\n            user: credentials.username,\r\n            password: credentials.password,\r\n            database: credentials.database,\r\n            port: credentials.port,\r\n            ssl: credentials.ssl,\r\n            connectionTimeoutMillis: options.connectTimeoutMS,\r\n            application_name: options.applicationName\r\n        }, options.extra || {});\r\n\r\n        // create a connection pool\r\n        const pool = new this.postgres.Pool(connectionOptions);\r\n        const { logger } = this.connection;\r\n\r\n        const poolErrorHandler = options.poolErrorHandler || ((error: any) => logger.log(\"warn\", `Postgres pool raised an error. ${error}`));\r\n\r\n        /*\r\n          Attaching an error handler to pool errors is essential, as, otherwise, errors raised will go unhandled and\r\n          cause the hosting app to crash.\r\n         */\r\n        pool.on(\"error\", poolErrorHandler);\r\n\r\n        return new Promise((ok, fail) => {\r\n            pool.connect((err: any, connection: any, release: Function) => {\r\n                if (err) return fail(err);\r\n\r\n                if (options.logNotifications) {\r\n                    connection.on(\"notice\", (msg: any) => {\r\n                        msg && this.connection.logger.log(\"info\", msg.message);\r\n                    });\r\n                    connection.on(\"notification\", (msg: any) => {\r\n                        msg && this.connection.logger.log(\"info\", `Received NOTIFY on channel ${msg.channel}: ${msg.payload}.`);\r\n                    });\r\n                }\r\n                release();\r\n                ok(pool);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Closes connection pool.\r\n     */\r\n    protected async closePool(pool: any): Promise<void> {\r\n        while (this.connectedQueryRunners.length) {\r\n            await this.connectedQueryRunners[0].release();\r\n        }\r\n\r\n        return new Promise<void>((ok, fail) => {\r\n            pool.end((err: any) => err ? fail(err) : ok());\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Executes given query.\r\n     */\r\n    protected executeQuery(connection: any, query: string) {\r\n        this.connection.logger.logQuery(query);\r\n\r\n        return new Promise((ok, fail) => {\r\n            connection.query(query, (err: any, result: any) => err ? fail(err) : ok(result));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * If parameter is a datetime function, e.g. \"CURRENT_TIMESTAMP\", normalizes it.\r\n     * Otherwise returns original input.\r\n     */\r\n    protected normalizeDatetimeFunction(value: string) {\r\n        // check if input is datetime function\r\n        const upperCaseValue = value.toUpperCase();\r\n        const isDatetimeFunction = upperCaseValue.indexOf(\"CURRENT_TIMESTAMP\") !== -1\r\n            || upperCaseValue.indexOf(\"CURRENT_DATE\") !== -1\r\n            || upperCaseValue.indexOf(\"CURRENT_TIME\") !== -1\r\n            || upperCaseValue.indexOf(\"LOCALTIMESTAMP\") !== -1\r\n            || upperCaseValue.indexOf(\"LOCALTIME\") !== -1;\r\n\r\n        if (isDatetimeFunction) {\r\n            // extract precision, e.g. \"(3)\"\r\n            const precision = value.match(/\\(\\d+\\)/);\r\n\r\n            if (upperCaseValue.indexOf(\"CURRENT_TIMESTAMP\") !== -1) {\r\n                return precision ? `('now'::text)::timestamp${precision[0]} with time zone` : \"now()\";\r\n\r\n            } else if (upperCaseValue === \"CURRENT_DATE\") {\r\n                return \"('now'::text)::date\";\r\n\r\n            } else if (upperCaseValue.indexOf(\"CURRENT_TIME\") !== -1) {\r\n                return precision ? `('now'::text)::time${precision[0]} with time zone` : \"('now'::text)::time with time zone\";\r\n\r\n            } else if (upperCaseValue.indexOf(\"LOCALTIMESTAMP\") !== -1) {\r\n                return precision ? `('now'::text)::timestamp${precision[0]} without time zone` : \"('now'::text)::timestamp without time zone\";\r\n\r\n            } else if (upperCaseValue.indexOf(\"LOCALTIME\") !== -1) {\r\n                return precision ? `('now'::text)::time${precision[0]} without time zone` : \"('now'::text)::time without time zone\";\r\n            }\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * Escapes a given comment.\r\n     */\r\n    protected escapeComment(comment?: string) {\r\n        if (!comment) return comment;\r\n\r\n        comment = comment.replace(/\\u0000/g, \"\"); // Null bytes aren't allowed in comments\r\n\r\n        return comment;\r\n    }\r\n\r\n}\r\n"],"sourceRoot":"../.."}